<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interface Admin - Claudyne</title>
    <link rel="stylesheet" href="styles/glassmorphism.css">
    <link rel="stylesheet" href="styles/mobile-optimization.css">
    
    <!-- PWA et optimisations r√©seau -->
    <meta name="theme-color" content="#1a1a2e">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="preload" href="js/network-optimization.js" as="script" data-critical="true">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #F8FAFC !important;
            background-image: none !important;
            background-size: auto !important;
            animation: none !important;
            color: #1F2937 !important;
            min-height: 100vh;
        }
        
        /* Force override of glassmorphism background */
        body::before,
        body::after {
            display: none !important;
        }

        /* Override glassmorphism dark backgrounds for admin */
        .admin-interface body,
        .admin-interface .main-content,
        .admin-interface .content-area {
            background: #F8FAFC !important;
            color: #1F2937 !important;
        }

        /* Ensure text is always visible on light background */
        .admin-interface * {
            color: #1F2937 !important;
        }

        .admin-interface h1, 
        .admin-interface h2, 
        .admin-interface h3, 
        .admin-interface h4, 
        .admin-interface h5, 
        .admin-interface h6 {
            color: #1F2937 !important;
        }

        .admin-interface .sidebar {
            background: linear-gradient(135deg, #1F2937, #374151) !important;
            color: white !important;
        }

        .admin-interface .sidebar * {
            color: white !important;
        }

        .admin-interface .card,
        .admin-interface .stat-card {
            background: white !important;
            color: #1F2937 !important;
            border: 1px solid #E5E7EB !important;
        }

        .admin-interface .card *,
        .admin-interface .stat-card * {
            color: #1F2937 !important;
        }

        /* Override all glassmorphism effects for admin */
        .admin-interface .glass,
        .admin-interface .glass-card,
        .admin-interface .glass-btn {
            background: white !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            color: #1F2937 !important;
        }

        /* Ensure main content area is always light */
        .admin-interface .main-content {
            background: #F8FAFC !important;
            background-image: none !important;
        }

        /* Override any dark text colors */
        .admin-interface p,
        .admin-interface span,
        .admin-interface div,
        .admin-interface td,
        .admin-interface th,
        .admin-interface label {
            color: #1F2937 !important;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #1F2937, #374151);
            color: white;
            padding: 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 2rem 1.5rem 1rem;
            border-bottom: 1px solid #4B5563;
            text-align: center;
        }

        .admin-logo {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .admin-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .admin-subtitle {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .nav-menu {
            list-style: none;
            padding: 1rem 0;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(16, 185, 129, 0.2);
            border-right: 3px solid #10B981;
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-right: 0.75rem;
            width: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #E5E7EB;
        }

        .page-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1F2937;
        }

        .page-description {
            color: #6B7280;
            margin-top: 0.5rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid;
        }

        .stat-card.primary { border-left-color: #10B981; }
        .stat-card.secondary { border-left-color: #3B82F6; }
        .stat-card.warning { border-left-color: #F59E0B; }
        .stat-card.danger { border-left-color: #EF4444; }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .stat-title {
            color: #6B7280;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .stat-icon {
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1F2937;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive { color: #10B981; }
        .stat-change.negative { color: #EF4444; }

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1F2937;
        }

        .section-content {
            padding: 1.5rem;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        .data-table th {
            background: #F9FAFB;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }

        .data-table tr:hover {
            background: #F9FAFB;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.active {
            background: #D1FAE5;
            color: #065F46;
        }

        .status-badge.pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .status-badge.inactive {
            background: #FEE2E2;
            color: #991B1B;
        }

        .status-badge.trial {
            background: #DBEAFE;
            color: #1E40AF;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #10B981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #6B7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4B5563;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
        
        .btn-tab {
            background: #F3F4F6;
            color: #4B5563;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-tab:hover {
            background: #E5E7EB;
        }

        .btn-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .content-tab-panel {
            display: block;
        }

        .content-tab-panel.hidden {
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .badge-info {
            background: #DBEAFE;
            color: #1E40AF;
        }
        
        .account-type-option {
            cursor: pointer;
            flex: 1;
        }
        
        .account-type-option input[type="radio"] {
            display: none;
        }
        
        .account-type-card {
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            background: #F9FAFB;
        }
        
        .account-type-card:hover {
            border-color: #D1D5DB;
            background: #F3F4F6;
        }
        
        .account-type-option input[type="radio"]:checked + .account-type-card {
            border-color: #10B981;
            background: #ECFDF5;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .account-type-card h3 {
            margin: 0.5rem 0;
            color: #1F2937;
            font-size: 1.1rem;
        }
        
        .account-type-card p {
            margin: 0.25rem 0;
            color: #6B7280;
            font-size: 0.875rem;
        }
        
        .account-type-card small {
            color: #9CA3AF;
            font-size: 0.75rem;
        }
        
        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #E5E7EB;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .form-section h3 {
            color: #1F2937;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .btn-success {
            background: #10B981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #EF4444;
            color: white;
        }

        .btn-danger:hover {
            background: #DC2626;
        }
        
        .btn-warning {
            background: #F59E0B;
            color: white;
        }

        .btn-warning:hover {
            background: #D97706;
        }

        /* Charts */
        .chart-container {
            height: 300px;
            display: flex;
            align-items: end;
            gap: 1rem;
            padding: 1rem;
            background: #F9FAFB;
            border-radius: 8px;
        }

        .chart-bar {
            background: #10B981;
            border-radius: 4px 4px 0 0;
            min-width: 30px;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            background: #059669;
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: #6B7280;
            white-space: nowrap;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #10B981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: static;
                height: auto;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }

        /* Styles pour les plans tarifaires */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .plan-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-card:hover {
            border-color: #3B82F6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .plan-card.featured {
            border-color: #10B981;
            background: linear-gradient(135deg, #ECFDF5 0%, #F0FDF4 100%);
        }

        .plan-card.featured::before {
            content: "‚≠ê Populaire";
            position: absolute;
            top: -10px;
            right: 1rem;
            background: #10B981;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .plan-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #E5E7EB;
        }

        .plan-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 0.5rem;
        }

        .plan-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        .plan-type.individual {
            background: #DBEAFE;
            color: #1D4ED8;
        }

        .plan-type.family {
            background: #DCFCE7;
            color: #166534;
        }

        .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 0.25rem;
        }

        .plan-duration {
            color: #6B7280;
            font-size: 0.875rem;
        }

        .plan-features {
            margin: 1.5rem 0;
        }

        .plan-features ul {
            list-style: none;
            padding: 0;
        }

        .plan-features li {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            color: #4B5563;
            font-size: 0.875rem;
        }

        .plan-features li::before {
            content: "‚úÖ";
            margin-right: 0.75rem;
        }

        .plan-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .checkbox-item:hover {
            background-color: #F9FAFB;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 0.5rem;
        }

        .filter-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-group select {
            padding: 0.5rem;
            border: 1px solid #D1D5DB;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #E5E7EB;
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .plan-status {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .plan-status.active {
            background: #DCFCE7;
            color: #166534;
        }

        .plan-status.inactive {
            background: #FEE2E2;
            color: #DC2626;
        }

        .plan-status.draft {
            background: #F3F4F6;
            color: #6B7280;
        }

        /* Styles pour le formulaire de connexion admin */
        .admin-login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .admin-login-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 3rem 2.5rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .admin-login-header h1 {
            color: #1F2937 !important;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .admin-login-header p {
            color: #6B7280 !important;
            font-size: 0.9rem;
        }

        .admin-login-form .input-group {
            margin-bottom: 1.5rem;
        }

        .admin-login-form label {
            display: block;
            color: #374151 !important;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .admin-login-form input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            color: #1F2937 !important;
        }

        .admin-login-form input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .admin-login-btn {
            width: 100%;
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            color: white !important;
            border: none;
            padding: 0.875rem 1rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .admin-login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .admin-error-message {
            background: #FEE2E2;
            color: #DC2626 !important;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.9rem;
            border-left: 4px solid #DC2626;
        }

        .admin-login-footer {
            text-align: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #E5E7EB;
        }

        .admin-login-footer p {
            color: #6B7280 !important;
            font-size: 0.8rem;
        }

        /* Cacher l'interface admin par d√©faut */
        .admin-container {
            display: none;
        }

        .admin-container.authenticated {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Formulaire de connexion administrateur -->
    <div id="adminLoginForm" class="admin-login-overlay">
        <div class="admin-login-container">
            <div class="admin-login-header">
                <h1>üîê Connexion Administrateur</h1>
                <p>Acc√®s s√©curis√© √† l'interface d'administration Claudyne</p>
            </div>

            <form id="adminAuthForm" class="admin-login-form">
                <div class="input-group">
                    <label for="adminEmail">Email administrateur</label>
                    <input type="email" id="adminEmail" name="email" placeholder="admin@claudyne.com" required>
                </div>

                <div class="input-group">
                    <label for="adminPassword">Mot de passe</label>
                    <input type="password" id="adminPassword" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>

                <button type="submit" id="adminLoginBtn" class="admin-login-btn">
                    Se connecter
                </button>

                <div style="text-align: center; margin-top: 1rem;">
                    <button type="button" onclick="showForgotPassword()" style="
                        background: none;
                        border: none;
                        color: #3B82F6;
                        font-size: 0.9rem;
                        cursor: pointer;
                        text-decoration: underline;
                        padding: 0.5rem;
                    ">
                        Mot de passe oubli√© ?
                    </button>
                </div>

                <div id="adminLoginError" class="admin-error-message" style="display: none;"></div>
            </form>

            <div class="admin-login-footer">
                <p>Interface r√©serv√©e aux administrateurs autoris√©s</p>
            </div>
        </div>
    </div>

    <!-- Modal Mot de passe oubli√© -->
    <div id="forgotPasswordModal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 20000;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    ">
        <div style="
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        ">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üîê</div>
                <h2 style="color: #1F2937; margin: 0; font-size: 1.5rem;">
                    R√©cup√©ration de mot de passe
                </h2>
                <p style="color: #6B7280; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                    Entrez votre email pour recevoir un lien de r√©initialisation
                </p>
            </div>

            <form id="forgotPasswordForm">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; color: #374151; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem;">
                        Email administrateur
                    </label>
                    <input type="email" id="forgotEmail" required style="
                        width: 100%;
                        padding: 0.875rem 1rem;
                        border: 2px solid #E5E7EB;
                        border-radius: 10px;
                        font-size: 1rem;
                        transition: all 0.2s;
                        box-sizing: border-box;
                    " placeholder="admin@claudyne.com">
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" onclick="closeForgotPassword()" style="
                        flex: 1;
                        background: #F3F4F6;
                        color: #374151;
                        border: none;
                        padding: 0.875rem 1rem;
                        border-radius: 10px;
                        font-size: 1rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s;
                    ">
                        Annuler
                    </button>
                    <button type="submit" id="sendResetBtn" style="
                        flex: 1;
                        background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
                        color: white;
                        border: none;
                        padding: 0.875rem 1rem;
                        border-radius: 10px;
                        font-size: 1rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s;
                    ">
                        Envoyer le lien
                    </button>
                </div>

                <div id="forgotPasswordMessage" style="
                    margin-top: 1rem;
                    padding: 0.875rem;
                    border-radius: 10px;
                    font-size: 0.9rem;
                    display: none;
                "></div>
            </form>
        </div>
    </div>

    <!-- Particules d'arri√®re-plan -->
    <div class="glass-particles">
        <div class="glass-particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="glass-particle" style="left: 20%; animation-delay: 1s;"></div>
        <div class="glass-particle" style="left: 30%; animation-delay: 2s;"></div>
        <div class="glass-particle" style="left: 40%; animation-delay: 0.5s;"></div>
        <div class="glass-particle" style="left: 50%; animation-delay: 1.5s;"></div>
        <div class="glass-particle" style="left: 60%; animation-delay: 2.5s;"></div>
        <div class="glass-particle" style="left: 70%; animation-delay: 0.2s;"></div>
        <div class="glass-particle" style="left: 80%; animation-delay: 1.2s;"></div>
        <div class="glass-particle" style="left: 90%; animation-delay: 2.2s;"></div>
    </div>

    <div class="admin-container admin-interface">
        <!-- Sidebar -->
        <div class="sidebar glass-nav">
            <div class="sidebar-header glass-text-primary">
                <div class="admin-logo animate-pulse">üë®‚Äçüíº</div>
                <div class="admin-title glass-text-primary">Admin Claudyne</div>
                <div class="admin-subtitle glass-text-secondary">Panneau de contr√¥le</div>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <span class="nav-icon">üìä</span>
                            Tableau de bord
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('users')">
                            <span class="nav-icon">üë•</span>
                            Gestion des familles
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('family-links')">
                            <span class="nav-icon">üîó</span>
                            Liaisons Famille-√âtudiants
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('roles-management')">
                            <span class="nav-icon">üé≠</span>
                            Gestion des r√¥les
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('staff-management')">
                            <span class="nav-icon">üë®‚Äçüè´</span>
                            √âquipe p√©dagogique
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('content')">
                            <span class="nav-icon">üìö</span>
                            Contenu p√©dagogique
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('payments')">
                            <span class="nav-icon">üí∞</span>
                            Paiements
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('analytics')">
                            <span class="nav-icon">üìà</span>
                            Analyses
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('free-modules')">
                            <span class="nav-icon">üÜì</span>
                            Modules gratuits
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('trial-management')">
                            <span class="nav-icon">‚è∞</span>
                            Gestion essais
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('communication')">
                            <span class="nav-icon">üìß</span>
                            Communication
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('reports')">
                            <span class="nav-icon">üìä</span>
                            Rapports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('system-monitoring')">
                            <span class="nav-icon">üñ•Ô∏è</span>
                            Monitoring
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('pricing-plans')">
                            <span class="nav-icon">üí∞</span>
                            Plans tarifaires
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="showSection('settings')">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            Param√®tres
                        </a>
                    </li>
                    <li class="nav-item" style="margin-top: 2rem; border-top: 1px solid #4B5563; padding-top: 1rem;">
                        <a class="nav-link glass-nav-item" href="javascript:void(0)" onclick="adminLogout()" style="color: #F87171 !important;">
                            <span class="nav-icon">üö™</span>
                            Se d√©connecter
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Tableau de bord</h1>
                        <p class="page-description">Vue d'ensemble de la plateforme Claudyne</p>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card glass-stat-card primary">
                        <div class="stat-header">
                            <span class="stat-title">Familles Actives</span>
                            <span class="stat-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="active-families">-</div>
                        <div class="stat-change positive">+12% ce mois</div>
                    </div>

                    <div class="stat-card glass-stat-card secondary">
                        <div class="stat-header">
                            <span class="stat-title">√âtudiants Actifs</span>
                            <span class="stat-icon">üéì</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="active-students">-</div>
                        <div class="stat-change positive">+8% ce mois</div>
                    </div>

                    <div class="stat-card glass-stat-card warning">
                        <div class="stat-header">
                            <span class="stat-title">Revenus (Mois)</span>
                            <span class="stat-icon">üí∞</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="monthly-revenue">-</div>
                        <div class="stat-change positive">+15% ce mois</div>
                    </div>

                    <div class="stat-card glass-stat-card danger">
                        <div class="stat-header">
                            <span class="stat-title">Quiz Termin√©s</span>
                            <span class="stat-icon">üß†</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="quizzes-taken">-</div>
                        <div class="stat-change positive">+22% ce mois</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Activit√© r√©cente</h2>
                        <button class="btn btn-primary btn-sm">Actualiser</button>
                    </div>
                    <div class="section-content">
                        <div id="recent-activity">
                            <div class="loading"></div> Chargement des activit√©s...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Gestion des abonn√©s</h1>
                        <p class="page-description">Comptes familiaux et individuels - Cr√©ation, modification, suivi - Contr√¥le total de la base abonn√©s</p>
                    </div>
                </div>

                <!-- Search and Filter Tools -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Recherche et filtres</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Rechercher par ID abonn√©</label>
                                <input type="text" id="subscriberIdSearch" placeholder="Ex: FAM-001234 ou IND-005678" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nom / Titre compte</label>
                                <input type="text" id="accountNameSearch" placeholder="Famille Mbarga, Jean Doe..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Statut</label>
                                <select id="statusFilter" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="">Tous</option>
                                    <option value="active">Actif</option>
                                    <option value="trial">Essai</option>
                                    <option value="expired">Expir√©</option>
                                    <option value="suspended">Suspendu</option>
                                </select>
                            </div>
                            <button class="btn btn-primary glass-btn glass-btn-primary" onclick="searchSubscribers()" style="padding: 0.75rem 1.5rem;">üîç Rechercher</button>
                        </div>
                    </div>
                </div>

                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Abonn√©s enregistr√©s</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-success btn-sm" onclick="showCreateAccountModal()">‚ûï Nouveau Compte</button>
                            <button class="btn btn-secondary btn-sm" onclick="showTrialManagement()">üìÖ Gestion Essais</button>
                            <button class="btn btn-primary btn-sm" onclick="exportSubscribersCSV()">üìä Exporter CSV</button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div id="users-table">
                            <div class="loading"></div> Chargement des familles...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Section -->
            <div id="content-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Contenu p√©dagogique</h1>
                        <p class="page-description">Gestion des cours, quiz et √©valuations</p>
                    </div>
                </div>

                <!-- Content Management Tabs -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-tab active" onclick="showContentTab('courses')" id="courses-tab">üìö Cours</button>
                            <button class="btn btn-tab" onclick="showContentTab('quizzes')" id="quizzes-tab">üß† Quiz</button>
                            <button class="btn btn-tab" onclick="showContentTab('resources')" id="resources-tab">üìñ Ressources</button>
                        </div>
                        <div class="dropdown" style="position: relative; display: inline-block;">
                            <button class="btn btn-primary btn-sm glass-btn glass-btn-primary" id="addContentBtn">‚ûï Ajouter contenu</button>
                            <div class="dropdown-content" id="addContentDropdown" style="display: none; position: absolute; background: rgba(255,255,255,0.95); min-width: 200px; border-radius: 12px; z-index: 1000; top: 100%;">
                                <button class="glass-btn" style="width: 100%; margin: 0.25rem 0; border-radius: 8px;" onclick="showAddCourseModal()">üìö Nouveau Cours</button>
                                <button class="glass-btn" style="width: 100%; margin: 0.25rem 0; border-radius: 8px;" onclick="showAddQuizModal()">üß† Nouveau Quiz</button>
                                <button class="glass-btn" style="width: 100%; margin: 0.25rem 0; border-radius: 8px;" onclick="showAddResourceModal()">üìñ Nouvelle Ressource</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-content">
                        <div id="courses-content" class="content-tab-panel">
                            <div id="courses-table">
                                <div class="loading"></div> Chargement des cours...
                            </div>
                        </div>
                        
                        <div id="quizzes-content" class="content-tab-panel hidden">
                            <div id="quizzes-table">
                                <div class="loading"></div> Chargement des quiz...
                            </div>
                        </div>
                        
                        <div id="resources-content" class="content-tab-panel hidden">
                            <div id="resources-table">
                                <div class="loading"></div> Chargement des ressources...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payments Section -->
            <div id="payments-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Gestion des paiements</h1>
                        <p class="page-description">Transactions et abonnements</p>
                    </div>
                </div>

                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Transactions r√©centes</h2>
                        <button class="btn btn-primary btn-sm">Exporter rapport</button>
                    </div>
                    <div class="section-content">
                        <div id="payments-table">
                            <div class="loading"></div> Chargement des transactions...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Analyses et rapports</h1>
                        <p class="page-description">Statistiques d√©taill√©es de la plateforme</p>
                    </div>
                </div>

                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Croissance des utilisateurs</h2>
                    </div>
                    <div class="section-content">
                        <div id="user-growth-chart" class="chart-container">
                            <div class="loading"></div> Chargement du graphique...
                        </div>
                    </div>
                </div>

                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Statistiques r√©gionales</h2>
                    </div>
                    <div class="section-content">
                        <div id="regional-stats">
                            <div class="loading"></div> Chargement des statistiques...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Free Modules Section -->
            <div id="free-modules-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Modules gratuits</h1>
                        <p class="page-description">Gestion du contenu gratuit accessible sans abonnement</p>
                    </div>
                </div>

                <!-- Free modules settings -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Param√®tres des modules gratuits</h2>
                        <button class="btn btn-primary btn-sm" onclick="saveFreeModuleSettings()">Sauvegarder param√®tres</button>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Max le√ßons gratuites par mati√®re</label>
                                <input type="number" id="maxFreeLessons" value="2" min="0" max="10" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Max quiz gratuits par mati√®re</label>
                                <input type="number" id="maxFreeQuizzes" value="1" min="0" max="5" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Dur√©e max par le√ßon (min)</label>
                                <input type="number" id="durationLimit" value="30" min="5" max="120" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div style="display: flex; align-items: center;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="allowProgressTracking" checked style="margin-right: 0.5rem;">
                                    Suivi de progression autoris√©
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Free modules list -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Modules gratuits disponibles</h2>
                        <button class="btn btn-primary btn-sm">Ajouter module</button>
                    </div>
                    <div class="section-content">
                        <div id="free-modules-table">
                            <div class="loading"></div> Chargement des modules gratuits...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trial Management Section -->
            <div id="trial-management-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Gestion des p√©riodes d'essai</h1>
                        <p class="page-description">Modifier les p√©riodes d'essai des familles individuellement</p>
                    </div>
                </div>

                <!-- Quick trial extension -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Extension rapide d'essai</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 2fr auto; gap: 1rem; align-items: end;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ID Famille</label>
                                <input type="text" id="familyId" placeholder="ex: 1, 2, 3..." style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nouveaux jours d'essai</label>
                                <input type="number" id="newTrialDays" value="14" min="1" max="90" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Raison de l'extension</label>
                                <input type="text" id="trialReason" placeholder="ex: Support technique, famille nombreuse..." style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <button class="btn btn-primary glass-btn glass-btn-primary" onclick="extendTrial()" style="padding: 0.6rem 1rem;">√âtendre essai</button>
                        </div>
                        <div id="trial-extension-result" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; display: none;"></div>
                    </div>
                </div>

                <!-- Trial extensions history -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Historique des extensions</h2>
                        <button class="btn btn-secondary btn-sm">Exporter rapport</button>
                    </div>
                    <div class="section-content">
                        <div id="trial-history-table">
                            <div class="loading"></div> Chargement de l'historique...
                        </div>
                    </div>
                </div>

                <!-- Trial statistics -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Statistiques des essais</h2>
                    </div>
                    <div class="section-content">
                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="stat-card glass-stat-card primary">
                                <div class="stat-header">
                                    <span class="stat-title">Extensions totales</span>
                                    <span class="stat-icon">üìà</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="total-extensions">-</div>
                                <div class="stat-change positive">Ce mois</div>
                            </div>
                            <div class="stat-card glass-stat-card secondary">
                                <div class="stat-header">
                                    <span class="stat-title">Dur√©e moyenne</span>
                                    <span class="stat-icon">‚è±Ô∏è</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="avg-extension-days">-</div>
                                <div class="stat-change">jours</div>
                            </div>
                            <div class="stat-card glass-stat-card warning">
                                <div class="stat-header">
                                    <span class="stat-title">Extensions actives</span>
                                    <span class="stat-icon">üîÑ</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="active-extensions">-</div>
                                <div class="stat-change">En cours</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Roles Management Section -->
            <div id="roles-management-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Gestion des r√¥les et permissions</h1>
                        <p class="page-description">Configuration des profils utilisateurs et leurs autorisations</p>
                    </div>
                </div>

                <!-- Roles Overview -->
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card glass-stat-card primary">
                        <div class="stat-header">
                            <span class="stat-title">Administrateurs</span>
                            <span class="stat-icon">üëë</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="admin-count">-</div>
                        <div class="stat-change">Acc√®s complet</div>
                    </div>
                    <div class="stat-card glass-stat-card secondary">
                        <div class="stat-header">
                            <span class="stat-title">Enseignants</span>
                            <span class="stat-icon">üë®‚Äçüè´</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="teacher-count">-</div>
                        <div class="stat-change">Contenu p√©dagogique</div>
                    </div>
                    <div class="stat-card glass-stat-card warning">
                        <div class="stat-header">
                            <span class="stat-title">Mod√©rateurs</span>
                            <span class="stat-icon">üõ°Ô∏è</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="moderator-count">-</div>
                        <div class="stat-change">Mod√©ration</div>
                    </div>
                    <div class="stat-card glass-stat-card danger">
                        <div class="stat-header">
                            <span class="stat-title">Validateurs</span>
                            <span class="stat-icon">‚úÖ</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="validator-count">-</div>
                        <div class="stat-change">Validation contenu</div>
                    </div>
                </div>

                <!-- Role Creation -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Cr√©er un nouveau r√¥le</h2>
                        <button class="btn btn-primary glass-btn glass-btn-primary" onclick="createNewRole()">+ Nouveau r√¥le</button>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 1.5rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nom du r√¥le</label>
                                <input type="text" id="roleName" placeholder="Ex: Superviseur r√©gional" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Niveau hi√©rarchique</label>
                                <select id="roleLevel" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="1">1 - Super Admin</option>
                                    <option value="2">2 - Admin r√©gional</option>
                                    <option value="3">3 - Coordinateur</option>
                                    <option value="4">4 - Enseignant senior</option>
                                    <option value="5">5 - Enseignant</option>
                                    <option value="6">6 - Assistant</option>
                                    <option value="7">7 - Stagiaire</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Description</label>
                                <input type="text" id="roleDescription" placeholder="Description des responsabilit√©s" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                        </div>
                        
                        <!-- Permissions Grid -->
                        <div style="margin-top: 1.5rem;">
                            <h4 style="margin-bottom: 1rem; color: #1F2937;">Permissions</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                                <div style="border: 1px solid #E5E7EB; border-radius: 6px; padding: 1rem;">
                                    <h5 style="margin-bottom: 0.5rem; color: #374151;">üë• Gestion utilisateurs</h5>
                                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                        <label><input type="checkbox" id="perm-users-read"> Consulter</label>
                                        <label><input type="checkbox" id="perm-users-create"> Cr√©er</label>
                                        <label><input type="checkbox" id="perm-users-edit"> Modifier</label>
                                        <label><input type="checkbox" id="perm-users-delete"> Supprimer</label>
                                    </div>
                                </div>
                                <div style="border: 1px solid #E5E7EB; border-radius: 6px; padding: 1rem;">
                                    <h5 style="margin-bottom: 0.5rem; color: #374151;">üìö Contenu p√©dagogique</h5>
                                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                        <label><input type="checkbox" id="perm-content-read"> Consulter</label>
                                        <label><input type="checkbox" id="perm-content-create"> Cr√©er</label>
                                        <label><input type="checkbox" id="perm-content-edit"> Modifier</label>
                                        <label><input type="checkbox" id="perm-content-validate"> Valider</label>
                                    </div>
                                </div>
                                <div style="border: 1px solid #E5E7EB; border-radius: 6px; padding: 1rem;">
                                    <h5 style="margin-bottom: 0.5rem; color: #374151;">üí∞ Finances</h5>
                                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                        <label><input type="checkbox" id="perm-finance-read"> Consulter</label>
                                        <label><input type="checkbox" id="perm-finance-manage"> G√©rer paiements</label>
                                        <label><input type="checkbox" id="perm-finance-reports"> Rapports</label>
                                        <label><input type="checkbox" id="perm-finance-admin"> Admin finances</label>
                                    </div>
                                </div>
                                <div style="border: 1px solid #E5E7EB; border-radius: 6px; padding: 1rem;">
                                    <h5 style="margin-bottom: 0.5rem; color: #374151;">‚öôÔ∏è Syst√®me</h5>
                                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                        <label><input type="checkbox" id="perm-system-read"> Monitoring</label>
                                        <label><input type="checkbox" id="perm-system-backup"> Sauvegardes</label>
                                        <label><input type="checkbox" id="perm-system-config"> Configuration</label>
                                        <label><input type="checkbox" id="perm-system-admin"> Admin syst√®me</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 1.5rem;">
                            <button class="btn btn-primary glass-btn glass-btn-primary" onclick="saveRole()">üíæ Sauvegarder le r√¥le</button>
                            <button class="btn btn-secondary glass-btn" onclick="resetRoleForm()">üîÑ R√©initialiser</button>
                        </div>
                        <div id="role-creation-result" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; display: none;"></div>
                    </div>
                </div>

                <!-- Existing Roles -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">R√¥les configur√©s</h2>
                        <button class="btn btn-secondary btn-sm">Exporter config</button>
                    </div>
                    <div class="section-content">
                        <div id="roles-table">
                            <div class="loading"></div> Chargement des r√¥les...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Staff Management Section -->
            <div id="staff-management-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">√âquipe p√©dagogique</h1>
                        <p class="page-description">Gestion du personnel enseignant et administratif</p>
                    </div>
                </div>

                <!-- Staff Overview -->
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card glass-stat-card primary">
                        <div class="stat-header">
                            <span class="stat-title">Personnel total</span>
                            <span class="stat-icon">üë•</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="total-staff">-</div>
                        <div class="stat-change positive">+3 ce mois</div>
                    </div>
                    <div class="stat-card glass-stat-card secondary">
                        <div class="stat-header">
                            <span class="stat-title">Actifs aujourd'hui</span>
                            <span class="stat-icon">üü¢</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="active-staff-today">-</div>
                        <div class="stat-change">en ligne</div>
                    </div>
                    <div class="stat-card glass-stat-card warning">
                        <div class="stat-header">
                            <span class="stat-title">En formation</span>
                            <span class="stat-icon">üìñ</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="staff-in-training">-</div>
                        <div class="stat-change">cette semaine</div>
                    </div>
                    <div class="stat-card glass-stat-card danger">
                        <div class="stat-header">
                            <span class="stat-title">√âvaluations en cours</span>
                            <span class="stat-icon">üìä</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="staff-evaluations">-</div>
                        <div class="stat-change">√† compl√©ter</div>
                    </div>
                </div>

                <!-- Add New Staff Member -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Ajouter un membre de l'√©quipe</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Pr√©nom</label>
                                <input type="text" id="staffFirstName" placeholder="Jean" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nom</label>
                                <input type="text" id="staffLastName" placeholder="Mballa" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                                <input type="email" id="staffEmail" placeholder="jean.mballa@claudyne.com" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">T√©l√©phone</label>
                                <input type="tel" id="staffPhone" placeholder="+237 6XX XX XX XX" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">R√¥le principal</label>
                                <select id="staffRole" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="admin">üëë Administrateur</option>
                                    <option value="teacher">üë®‚Äçüè´ Enseignant</option>
                                    <option value="moderator">üõ°Ô∏è Mod√©rateur</option>
                                    <option value="validator">‚úÖ Validateur</option>
                                    <option value="support">üéß Support</option>
                                    <option value="analyst">üìä Analyste</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">R√©gion</label>
                                <select id="staffRegion" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="centre">Centre</option>
                                    <option value="littoral">Littoral</option>
                                    <option value="ouest">Ouest</option>
                                    <option value="nord-ouest">Nord-Ouest</option>
                                    <option value="sud-ouest">Sud-Ouest</option>
                                    <option value="adamaoua">Adamaoua</option>
                                    <option value="est">Est</option>
                                    <option value="nord">Nord</option>
                                    <option value="extreme-nord">Extr√™me-Nord</option>
                                    <option value="sud">Sud</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Sp√©cialit√©</label>
                                <select id="staffSpeciality" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="mathematics">Math√©matiques</option>
                                    <option value="french">Fran√ßais</option>
                                    <option value="english">Anglais</option>
                                    <option value="sciences">Sciences</option>
                                    <option value="history">Histoire-G√©ographie</option>
                                    <option value="technology">Technologies</option>
                                    <option value="management">Gestion</option>
                                    <option value="support">Support technique</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Date d'embauche</label>
                                <input type="date" id="staffHireDate" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Notes biographiques</label>
                            <textarea id="staffBio" placeholder="Formation, exp√©rience, comp√©tences particuli√®res..." style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px; resize: vertical;" rows="3"></textarea>
                        </div>

                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <button class="btn btn-primary glass-btn glass-btn-primary" onclick="addStaffMember()">üë§ Ajouter membre</button>
                            <button class="btn btn-secondary glass-btn" onclick="importStaffCSV()">üì• Importer CSV</button>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="sendWelcomeEmail" checked style="margin-right: 0.5rem;">
                                Envoyer email de bienvenue
                            </label>
                        </div>
                        <div id="staff-addition-result" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; display: none;"></div>
                    </div>
                </div>

                <!-- Staff Directory -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Annuaire du personnel</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <select id="staffFilter" style="padding: 0.375rem 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 0.75rem;">
                                <option value="all">Tous les r√¥les</option>
                                <option value="admin">Administrateurs</option>
                                <option value="teacher">Enseignants</option>
                                <option value="moderator">Mod√©rateurs</option>
                                <option value="validator">Validateurs</option>
                            </select>
                            <button class="btn btn-secondary btn-sm" onclick="exportStaffDirectory()">üì§ Exporter annuaire</button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div id="staff-directory-table">
                            <div class="loading"></div> Chargement de l'annuaire...
                        </div>
                    </div>
                </div>

                <!-- Performance Dashboard -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Tableau de performance de l'√©quipe</h2>
                    </div>
                    <div class="section-content">
                        <div id="staff-performance-chart" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div class="loading"></div> Chargement des performances...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Communication Section -->
            <div id="communication-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Communication</h1>
                        <p class="page-description">Envoi de notifications et messages aux abonn√©s</p>
                    </div>
                </div>

                <!-- Quick Message -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Message rapide</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Destinataires</label>
                                <select id="messageRecipients" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="all">Tous les abonn√©s</option>
                                    <option value="active">Abonn√©s actifs</option>
                                    <option value="trial">Abonn√©s en essai</option>
                                    <option value="expired">Essais expir√©s</option>
                                    <option value="family">Comptes familiaux</option>
                                    <option value="individual">Comptes individuels</option>
                                    <option value="custom">S√©lection personnalis√©e</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Canal d'envoi</label>
                                <select id="messageChannel" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="email">üì¨ Email</option>
                                    <option value="sms">üì± SMS</option>
                                    <option value="popup">üì¢ Pop-up (App)</option>
                                    <option value="all_channels">üöÄ Tous les canaux</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Type de message</label>
                                <select id="messageType" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="info">Information</option>
                                    <option value="promotion">Promotion</option>
                                    <option value="reminder">Rappel</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="urgent">‚ö†Ô∏è Urgent</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Objet</label>
                            <input type="text" id="messageSubject" placeholder="Ex: Nouvelle fonctionnalit√© disponible" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Message</label>
                            <textarea id="messageContent" rows="4" placeholder="R√©digez votre message ici..." style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px; resize: vertical;"></textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <button class="btn btn-primary glass-btn glass-btn-primary" onclick="sendMessage()">üìß Envoyer message</button>
                            <button class="btn btn-secondary glass-btn" onclick="previewMessage()">üëÅÔ∏è Aper√ßu</button>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="scheduleMessage" style="margin-right: 0.5rem;">
                                Programmer l'envoi
                            </label>
                        </div>
                        <div id="message-result" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; display: none;"></div>
                    </div>
                </div>

                <!-- Message History -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Historique des messages</h2>
                        <button class="btn btn-secondary btn-sm">Voir tout</button>
                    </div>
                    <div class="section-content">
                        <div id="message-history-table">
                            <div class="loading"></div> Chargement de l'historique...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Rapports d√©taill√©s</h1>
                        <p class="page-description">G√©n√©ration de rapports personnalis√©s</p>
                    </div>
                </div>

                <!-- Report Generator -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">G√©n√©rateur de rapports</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Type de rapport</label>
                                <select id="reportType" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="users">Rapport utilisateurs</option>
                                    <option value="revenue">Rapport revenus</option>
                                    <option value="content">Rapport contenu</option>
                                    <option value="engagement">Rapport engagement</option>
                                    <option value="regional">Rapport r√©gional</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">P√©riode</label>
                                <select id="reportPeriod" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="week">7 derniers jours</option>
                                    <option value="month">30 derniers jours</option>
                                    <option value="quarter">90 derniers jours</option>
                                    <option value="year">12 derniers mois</option>
                                    <option value="custom">P√©riode personnalis√©e</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Format</label>
                                <select id="reportFormat" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                    <option value="json">JSON</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button class="btn btn-primary glass-btn glass-btn-primary" onclick="generateReport()" style="width: 100%;">üìä G√©n√©rer rapport</button>
                            </div>
                        </div>
                        <div id="report-result" style="margin-top: 1rem; padding: 0.75rem; border-radius: 6px; display: none;"></div>
                    </div>
                </div>

                <!-- Scheduled Reports -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Rapports programm√©s</h2>
                        <button class="btn btn-primary btn-sm" onclick="scheduleNewReport()">+ Nouveau</button>
                    </div>
                    <div class="section-content">
                        <div id="scheduled-reports-table">
                            <div class="loading"></div> Chargement des rapports programm√©s...
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Monitoring Section -->
            <div id="system-monitoring-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Monitoring syst√®me</h1>
                        <p class="page-description">Surveillance de la performance et sant√© du syst√®me</p>
                    </div>
                </div>

                <!-- System Health -->
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card glass-stat-card primary">
                        <div class="stat-header">
                            <span class="stat-title">Statut serveur</span>
                            <span class="stat-icon" id="server-status">üü¢</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="uptime-display">-</div>
                        <div class="stat-change">Uptime</div>
                    </div>
                    <div class="stat-card glass-stat-card secondary">
                        <div class="stat-header">
                            <span class="stat-title">Utilisation CPU</span>
                            <span class="stat-icon">‚ö°</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="cpu-usage">-</div>
                        <div class="stat-change">%</div>
                    </div>
                    <div class="stat-card glass-stat-card warning">
                        <div class="stat-header">
                            <span class="stat-title">M√©moire RAM</span>
                            <span class="stat-icon">üíæ</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="memory-usage">-</div>
                        <div class="stat-change">MB utilis√©s</div>
                    </div>
                    <div class="stat-card glass-stat-card danger">
                        <div class="stat-header">
                            <span class="stat-title">Erreurs (24h)</span>
                            <span class="stat-icon">‚ö†Ô∏è</span>
                        </div>
                        <div class="stat-value glass-stat-value" id="error-count">-</div>
                        <div class="stat-change">incidents</div>
                    </div>
                </div>

                <!-- System Logs -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Logs syst√®me r√©cents</h2>
                        <button class="btn btn-secondary btn-sm" onclick="refreshLogs()">üîÑ Actualiser</button>
                    </div>
                    <div class="section-content">
                        <div id="system-logs" style="background: #1F2937; color: #F3F4F6; padding: 1rem; border-radius: 6px; font-family: monospace; font-size: 0.875rem; max-height: 400px; overflow-y: auto;">
                            <div class="loading" style="color: #F3F4F6;"></div> Chargement des logs...
                        </div>
                    </div>
                </div>

                <!-- Backup Status -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">√âtat des sauvegardes</h2>
                        <button class="btn btn-primary btn-sm" onclick="triggerBackup()">üíæ Forcer sauvegarde</button>
                    </div>
                    <div class="section-content">
                        <div id="backup-status-table">
                            <div class="loading"></div> Chargement de l'√©tat des sauvegardes...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pricing Plans Section -->
            <div id="pricing-plans-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Gestion des plans tarifaires</h1>
                        <p class="page-description">Cr√©er et g√©rer les formules d'abonnement</p>
                    </div>
                    <button class="btn btn-primary glass-btn glass-btn-primary" onclick="showCreatePlanModal()">
                        ‚ûï Nouveau Plan
                    </button>
                </div>

                <!-- Current Plans -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Plans actuels</h2>
                        <div class="filter-group">
                            <select id="planTypeFilter" onchange="filterPlans()">
                                <option value="">Tous les types</option>
                                <option value="individual">Individuel</option>
                                <option value="family">Familial</option>
                            </select>
                            <select id="planStatusFilter" onchange="filterPlans()">
                                <option value="">Tous les statuts</option>
                                <option value="active">Actif</option>
                                <option value="inactive">Inactif</option>
                            </select>
                        </div>
                    </div>
                    <div class="section-content">
                        <div id="pricing-plans-grid" class="plans-grid">
                            <div class="loading"></div> Chargement des plans...
                        </div>
                    </div>
                </div>

                <!-- Plan Statistics -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Statistiques des abonnements</h2>
                    </div>
                    <div class="section-content">
                        <div class="stats-grid">
                            <div class="stat-card glass-stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Plans Actifs</span>
                                    <span class="stat-icon">‚úÖ</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="active-plans-count">-</div>
                            </div>
                            <div class="stat-card glass-stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Revenus Mensuels</span>
                                    <span class="stat-icon">üí∞</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="monthly-revenue-plans">-</div>
                            </div>
                            <div class="stat-card glass-stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Abonn√©s Total</span>
                                    <span class="stat-icon">üë•</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="total-subscribers">-</div>
                            </div>
                            <div class="stat-card glass-stat-card">
                                <div class="stat-header">
                                    <span class="stat-title">Plan Populaire</span>
                                    <span class="stat-icon">‚≠ê</span>
                                </div>
                                <div class="stat-value glass-stat-value" id="popular-plan">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Param√®tres</h1>
                        <p class="page-description">Configuration de la plateforme</p>
                    </div>
                </div>


                <!-- Admin Profile Settings -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">üîê Profil Administrateur</h2>
                        <button class="btn btn-secondary btn-sm" onclick="togglePasswordChange()">üîë Changer mot de passe</button>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email Admin</label>
                                <input type="email" id="adminEmail" value="admin@claudyne.com" readonly style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px; background-color: #F9FAFB;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Derni√®re connexion</label>
                                <input type="text" id="lastLogin" value="Il y a quelques minutes" readonly style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px; background-color: #F9FAFB;">
                            </div>
                        </div>

                        <!-- Change Password Form (Hidden by default) -->
                        <div id="passwordChangeForm" style="display: none; margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, #EEF2FF 0%, #F0F9FF 100%); border-radius: 8px; border: 1px solid #C7D2FE;">
                            <h3 style="margin: 0 0 1rem 0; color: #1E40AF; font-size: 1.1rem;">üîí Modifier le mot de passe</h3>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Mot de passe actuel</label>
                                    <input type="password" id="currentPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nouveau mot de passe</label>
                                    <input type="password" id="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Confirmer nouveau mot de passe</label>
                                    <input type="password" id="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                                    <button class="btn btn-primary" onclick="changeAdminPassword()">‚úÖ Modifier</button>
                                    <button class="btn btn-secondary" onclick="cancelPasswordChange()">‚ùå Annuler</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- General Settings -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Param√®tres g√©n√©raux</h2>
                        <button class="btn btn-primary btn-sm" onclick="saveSettings()">üíæ Sauvegarder</button>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nom de la plateforme</label>
                                <input type="text" id="siteName" value="Claudyne" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Slogan</label>
                                <input type="text" id="tagline" value="La force du savoir en h√©ritage" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email support</label>
                                <input type="email" id="supportEmail" value="support@claudyne.com" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">T√©l√©phone support</label>
                                <input type="tel" id="supportPhone" value="+237690000000" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Configuration -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Configuration des API</h2>
                        <span class="badge badge-warning">Sensible - Acc√®s restreint</span>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; gap: 1.5rem;">
                            <!-- Claude API -->
                            <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: #1F2937; font-size: 1.1rem;">ü§ñ Claude API (Anthropic)</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Key</label>
                                        <input type="password" id="claudeApiKey" placeholder="sk-ant-..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Mod√®le</label>
                                        <select id="claudeModel" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                            <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                                            <option value="claude-3-haiku">Claude 3 Haiku</option>
                                            <option value="claude-3-opus">Claude 3 Opus</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn btn-secondary btn-sm" onclick="testClaudeAPI()">üìã Tester la connexion</button>
                                </div>
                            </div>

                            <!-- SMS API (LMT SMS) -->
                            <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: #1F2937; font-size: 1.1rem;">üì± LMT SMS API</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Key LMT</label>
                                        <input type="password" id="lmtApiKey" placeholder="Cl√© API LMT SMS" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Sender ID</label>
                                        <input type="text" id="lmtSenderId" placeholder="CLAUDYNE" maxlength="11" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">URL API</label>
                                        <input type="url" id="lmtApiUrl" value="https://api.lmtsms.cm/send" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Co√ªt par SMS (FCFA)</label>
                                        <input type="number" id="smsCost" value="25" min="1" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn btn-secondary btn-sm" onclick="testSMSAPI()">üì± Envoyer SMS test</button>
                                </div>
                            </div>

                            <!-- Email SMTP Configuration -->
                            <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: #1F2937; font-size: 1.1rem;">üì¨ Configuration SMTP Email</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Serveur SMTP</label>
                                        <input type="text" id="smtpHost" placeholder="smtp.gmail.com" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Port</label>
                                        <input type="number" id="smtpPort" value="587" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Utilisateur SMTP</label>
                                        <input type="email" id="smtpUser" placeholder="noreply@claudyne.com" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Mot de passe SMTP</label>
                                        <input type="password" id="smtpPassword" placeholder="********" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                </div>
                                <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="smtpTls" checked style="margin-right: 0.5rem;">
                                        Utiliser TLS/STARTTLS
                                    </label>
                                    <button class="btn btn-secondary btn-sm" onclick="testEmailSMTP()">üì¨ Envoyer email test</button>
                                </div>
                            </div>

                            <!-- ChatGPT OpenAI Configuration -->
                            <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: #1F2937; font-size: 1.1rem;">ü§ñ ChatGPT API (OpenAI)</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Key OpenAI</label>
                                        <input type="password" id="openaiApiKey" placeholder="sk-proj-..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Mod√®le</label>
                                        <select id="openaiModel" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                            <option value="gpt-4o">GPT-4o (Recommand√©)</option>
                                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Temp√©rature (0-2)</label>
                                        <input type="number" id="openaiTemperature" value="0.7" min="0" max="2" step="0.1" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Max Tokens</label>
                                        <input type="number" id="openaiMaxTokens" value="2048" min="1" max="4096" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Prompt syst√®me par d√©faut</label>
                                    <textarea id="openaiSystemPrompt" rows="3" placeholder="Tu es un assistant p√©dagogique pour la plateforme Claudyne..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px; resize: vertical;"></textarea>
                                </div>
                                <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="openaiEnabled" style="margin-right: 0.5rem;">
                                        Activer l'int√©gration ChatGPT
                                    </label>
                                    <button class="btn btn-secondary btn-sm" onclick="testOpenAI()">ü§ñ Tester la connexion</button>
                                </div>
                            </div>

                            <!-- Future APIs Placeholder -->
                            <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 1.5rem;">
                                <h3 style="margin-bottom: 1rem; color: #1F2937; font-size: 1.1rem;">üöÄ APIs futures</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Paiement (Flutterwave)</label>
                                        <input type="password" id="flutterwaveKey" placeholder="FLWPUBK-..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Analytics (Google)</label>
                                        <input type="password" id="googleAnalyticsId" placeholder="GA-..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Push Notifications</label>
                                        <input type="password" id="pushNotificationKey" placeholder="Firebase Server Key" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">API Custom</label>
                                        <input type="text" id="customApiKey" placeholder="Future integration" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pricing Configuration -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Configuration tarifaire</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Plan Basique (FCFA/mois)</label>
                                <input type="number" id="basicPrice" value="2500" min="0" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Plan Premium (FCFA/mois)</label>
                                <input type="number" id="premiumPrice" value="4500" min="0" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Plan Famille (FCFA/an)</label>
                                <input type="number" id="familyPrice" value="45000" min="0" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Dur√©e essai (jours)</label>
                                <input type="number" id="trialDays" value="7" min="1" max="30" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Family-Student Links Section -->
            <div id="family-links-section" class="section hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üîó Liaisons Famille-√âtudiants</h1>
                        <p class="page-description">Gestion des relations entre comptes parents et profils √©tudiants - Visualisation et administration des liens familiaux</p>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="stats-grid animate-fadeInUp" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="stat-card glass-stat-card">
                        <div class="glass-stat-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        <div class="glass-stat-value" id="totalFamilies">248</div>
                        <div class="glass-stat-title">Familles actives</div>
                    </div>
                    <div class="stat-card glass-stat-card">
                        <div class="glass-stat-icon">üéì</div>
                        <div class="glass-stat-value" id="totalStudents">832</div>
                        <div class="glass-stat-title">√âtudiants inscrits</div>
                    </div>
                    <div class="stat-card glass-stat-card">
                        <div class="glass-stat-icon">üîó</div>
                        <div class="glass-stat-value" id="linkedStudents">756</div>
                        <div class="glass-stat-title">√âtudiants li√©s</div>
                    </div>
                    <div class="stat-card glass-stat-card">
                        <div class="glass-stat-icon">‚ö†Ô∏è</div>
                        <div class="glass-stat-value" id="orphanStudents">76</div>
                        <div class="glass-stat-title">Sans liaison</div>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Recherche et filtres</h2>
                    </div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Rechercher famille</label>
                                <input type="text" id="familySearch" placeholder="Nom de famille, ID..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Rechercher √©tudiant</label>
                                <input type="text" id="studentSearch" placeholder="Nom, pr√©nom..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Statut liaison</label>
                                <select id="linkStatusFilter" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="">Tous les statuts</option>
                                    <option value="linked">√âtudiants li√©s</option>
                                    <option value="orphaned">Sans liaison</option>
                                    <option value="multiple">Liaisons multiples</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="searchFamilyLinks()">
                                üîç Rechercher
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Family-Student Links Table -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">Liaisons actives</h2>
                        <div>
                            <button class="btn btn-success btn-sm" onclick="openLinkStudentModal()">
                                ‚ûï Cr√©er liaison
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="detectOrphanedStudents()">
                                ‚ö†Ô∏è D√©tecter orphelins
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="table-container">
                            <table class="glass-table" id="familyLinksTable">
                                <thead>
                                    <tr>
                                        <th>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille</th>
                                        <th>üéì √âtudiants li√©s</th>
                                        <th>üìä Statut</th>
                                        <th>üìÖ Derni√®re activit√©</th>
                                        <th>‚öôÔ∏è Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="familyLinksTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                                    NK
                                                </div>
                                                <div>
                                                    <div style="font-weight: 600;">Famille Nkoulou</div>
                                                    <div style="font-size: 0.875rem; color: #6B7280;">FAM-001234</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                                <span class="glass-badge glass-badge-success">üìö Marie Nkoulou (Terminale A)</span>
                                                <span class="glass-badge glass-badge-primary">üìñ Jean Nkoulou (3√®me)</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="glass-badge glass-badge-success">‚úÖ Actif</span>
                                        </td>
                                        <td>Il y a 2 heures</td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button class="btn btn-sm btn-outline" onclick="viewFamilyDetails('FAM-001234')" title="Voir d√©tails">
                                                    üëÅÔ∏è
                                                </button>
                                                <button class="btn btn-sm btn-primary" onclick="manageFamilyLinks('FAM-001234')" title="G√©rer liaisons">
                                                    üîó
                                                </button>
                                                <button class="btn btn-sm btn-warning" onclick="editFamily('FAM-001234')" title="Modifier">
                                                    ‚úèÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f093fb, #f5576c); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                                    AB
                                                </div>
                                                <div>
                                                    <div style="font-weight: 600;">Famille Abena</div>
                                                    <div style="font-size: 0.875rem; color: #6B7280;">FAM-002567</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                                <span class="glass-badge glass-badge-warning">‚ö†Ô∏è Paul Abena (1√®re S) - Orphelin</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="glass-badge glass-badge-warning">‚ö†Ô∏è Liaison manquante</span>
                                        </td>
                                        <td>Il y a 1 jour</td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button class="btn btn-sm btn-outline" onclick="viewFamilyDetails('FAM-002567')" title="Voir d√©tails">
                                                    üëÅÔ∏è
                                                </button>
                                                <button class="btn btn-sm btn-success" onclick="linkOrphanStudent('FAM-002567')" title="Lier √©tudiant">
                                                    üîó‚ûï
                                                </button>
                                                <button class="btn btn-sm btn-warning" onclick="editFamily('FAM-002567')" title="Modifier">
                                                    ‚úèÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Orphaned Students Section -->
                <div class="content-section glass-card animate-fadeInUp">
                    <div class="section-header">
                        <h2 class="section-title">‚ö†Ô∏è √âtudiants sans liaison familiale</h2>
                        <div>
                            <button class="btn btn-primary btn-sm" onclick="autoLinkOrphans()">
                                ü§ñ Liaison automatique
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="table-container">
                            <table class="glass-table" id="orphanStudentsTable">
                                <thead>
                                    <tr>
                                        <th>üéì √âtudiant</th>
                                        <th>üìö Niveau</th>
                                        <th>üìÖ Inscription</th>
                                        <th>üì± Contact</th>
                                        <th>‚öôÔ∏è Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="orphanStudentsTableBody">
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4facfe, #00f2fe); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                                    CK
                                                </div>
                                                <div>
                                                    <div style="font-weight: 600;">Claude Kameni</div>
                                                    <div style="font-size: 0.875rem; color: #6B7280;">STU-003456</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="glass-badge glass-badge-primary">Terminale C</span>
                                        </td>
                                        <td>15 Mars 2024</td>
                                        <td>
                                            <div style="font-size: 0.875rem;">
                                                <div>üìß claude.kameni@email.com</div>
                                                <div>üì± +237 696 123 456</div>
                                            </div>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button class="btn btn-sm btn-success" onclick="assignToFamily('STU-003456')" title="Assigner √† famille">
                                                    üë®‚Äçüë©‚Äçüëß‚Äçüë¶
                                                </button>
                                                <button class="btn btn-sm btn-primary" onclick="createNewFamily('STU-003456')" title="Cr√©er nouvelle famille">
                                                    ‚ûïüë®‚Äçüë©‚Äçüëß‚Äçüë¶
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour cr√©ation de compte -->
    <div id="createAccountModal" class="modal glass-modal">
        <div class="modal-content glass-modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('createAccountModal')">&times;</span>
            <h2>Cr√©er un nouveau compte abonn√©</h2>
            
            <!-- Choix du type de compte -->
            <div class="form-group">
                <label style="display: block; margin-bottom: 1rem; font-weight: 600; font-size: 1.1rem;">Type de compte</label>
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <label class="account-type-option" onclick="selectAccountType('individual')">
                        <input type="radio" name="accountType" value="individual" id="typeIndividual">
                        <div class="account-type-card">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üë§</div>
                            <h3>Compte Individuel</h3>
                            <p>Pour une personne seule</p>
                            <small>ID: IND-XXXXXX</small>
                        </div>
                    </label>
                    <label class="account-type-option" onclick="selectAccountType('family')">
                        <input type="radio" name="accountType" value="family" id="typeFamily">
                        <div class="account-type-card">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                            <h3>Compte Familial</h3>
                            <p>Pour toute la famille</p>
                            <small>ID: FAM-XXXXXX</small>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Formulaire dynamique -->
            <div id="accountForm" style="display: none;">
                <!-- Informations communes -->
                <div class="form-section">
                    <h3>Informations du responsable</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Pr√©nom *</label>
                            <input type="text" id="firstName" required style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                        <div class="form-group">
                            <label>Nom *</label>
                            <input type="text" id="lastName" required style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="email" required style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                        <div class="form-group">
                            <label>T√©l√©phone *</label>
                            <input type="tel" id="phone" placeholder="+237XXXXXXXXX" required style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                    </div>
                </div>

                <!-- Section famille (visible uniquement pour compte familial) -->
                <div id="familySection" style="display: none;">
                    <div class="form-section">
                        <h3>Informations familiales</h3>
                        <div class="form-group">
                            <label>Nom de famille *</label>
                            <input type="text" id="familyName" placeholder="Ex: Famille Mbarga" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Nombre d'enfants</label>
                                <input type="number" id="childrenCount" min="1" max="10" value="2" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                            </div>
                            <div class="form-group">
                                <label>R√©gion</label>
                                <select id="region" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                    <option value="">S√©lectionner...</option>
                                    <option value="Centre">Centre</option>
                                    <option value="Littoral">Littoral</option>
                                    <option value="Ouest">Ouest</option>
                                    <option value="Nord-Ouest">Nord-Ouest</option>
                                    <option value="Sud-Ouest">Sud-Ouest</option>
                                    <option value="Adamaoua">Adamaoua</option>
                                    <option value="Nord">Nord</option>
                                    <option value="Extr√™me-Nord">Extr√™me-Nord</option>
                                    <option value="Est">Est</option>
                                    <option value="Sud">Sud</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuration d'abonnement -->
                <div class="form-section">
                    <h3>Configuration d'abonnement</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Type d'abonnement</label>
                            <select id="subscriptionType" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                <option value="trial">Essai gratuit</option>
                                <option value="basic">Basique</option>
                                <option value="premium">Premium</option>
                                <option value="family">Famille</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Dur√©e essai (jours)</label>
                            <input type="number" id="trialDuration" value="7" min="1" max="30" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                        </div>
                        <div class="form-group">
                            <label>Statut initial</label>
                            <select id="initialStatus" style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                <option value="active">Actif</option>
                                <option value="trial">En essai</option>
                                <option value="pending">En attente</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Options avancees -->
                <div class="form-section">
                    <h3>Options avanc√©es</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="sendWelcomeEmail" checked style="margin-right: 0.5rem;">
                                Envoyer email de bienvenue
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="sendWelcomeSMS" style="margin-right: 0.5rem;">
                                Envoyer SMS de bienvenue
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes administratives</label>
                        <textarea id="adminNotes" rows="3" placeholder="Notes internes..." style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 6px; resize: vertical;"></textarea>
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #E5E7EB;">
                    <div>
                        <span style="font-size: 0.875rem; color: #6B7280;">* Champs obligatoires</span>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary glass-btn" onclick="closeModal('createAccountModal')">Annuler</button>
                        <button class="btn btn-primary glass-btn glass-btn-primary" onclick="previewAccount()">üëÅÔ∏è Aper√ßu</button>
                        <button class="btn btn-success glass-btn glass-btn-success" onclick="createAccount()">‚úÖ Cr√©er le compte</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation -->
    <div id="confirmationModal" class="modal glass-modal">
        <div class="modal-content glass-modal-content">
            <span class="close" onclick="closeModal('confirmationModal')">&times;</span>
            <h2 id="confirmationTitle">Confirmation de cr√©ation</h2>
            <div id="confirmationContent"></div>
            <div style="display: flex; justify-content: end; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-secondary glass-btn" onclick="closeModal('confirmationModal')">Retour</button>
                <button class="btn btn-success glass-btn glass-btn-success" onclick="confirmCreateAccount()">‚úÖ Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Modal de cr√©ation de plan tarifaire -->
    <div id="createPlanModal" class="modal glass-modal">
        <div class="modal-content glass-modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <span class="close" onclick="closeModal('createPlanModal')">&times;</span>
                <h2>Cr√©er un nouveau plan tarifaire</h2>
                <p>D√©finissez les caract√©ristiques du plan d'abonnement</p>
            </div>

            <div class="modal-body">
                <form id="createPlanForm">
                    <!-- Informations de base -->
                    <div class="form-group">
                        <label for="planName">Nom du plan *</label>
                        <input type="text" id="planName" name="planName" placeholder="Ex: Premium Familial" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="planType">Type de compte *</label>
                            <select id="planType" name="planType" required onchange="updatePlanFields()">
                                <option value="">S√©lectionner...</option>
                                <option value="individual">Individuel</option>
                                <option value="family">Familial</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="planCategory">Cat√©gorie *</label>
                            <select id="planCategory" name="planCategory" required>
                                <option value="">S√©lectionner...</option>
                                <option value="basique">Basique</option>
                                <option value="premium">Premium</option>
                                <option value="mixte">Mixte</option>
                                <option value="trial">Essai</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                    </div>

                    <!-- Tarification -->
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="planPrice">Prix (FCFA) *</label>
                            <input type="number" id="planPrice" name="planPrice" min="0" placeholder="5000" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="planDuration">Dur√©e *</label>
                            <select id="planDuration" name="planDuration" required>
                                <option value="">S√©lectionner...</option>
                                <option value="monthly">Mensuel (1 mois)</option>
                                <option value="quarterly">Trimestriel (3 mois)</option>
                                <option value="annual">Annuel (12 mois)</option>
                                <option value="trial">Essai (jours)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dur√©e essai (si applicable) -->
                    <div class="form-group" id="trialDaysGroup" style="display: none;">
                        <label for="trialDays">Dur√©e de l'essai (jours)</label>
                        <input type="number" id="trialDays" name="trialDays" min="1" max="90" placeholder="7">
                    </div>

                    <!-- Fonctionnalit√©s -->
                    <div class="form-group">
                        <label>Fonctionnalit√©s incluses</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="features" value="courses" checked>
                                <span>Acc√®s aux cours</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="features" value="quizzes">
                                <span>Quiz interactifs</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="features" value="progress">
                                <span>Suivi de progression</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="features" value="certificates">
                                <span>Certificats</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="features" value="support">
                                <span>Support prioritaire</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="features" value="offline">
                                <span>Acc√®s hors ligne</span>
                            </label>
                        </div>
                    </div>

                    <!-- Limites (pour compte familial) -->
                    <div id="familyLimits" style="display: none;">
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="maxChildren">Nombre max d'enfants</label>
                                <input type="number" id="maxChildren" name="maxChildren" min="1" max="10" placeholder="5">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="maxDevices">Appareils simultan√©s</label>
                                <input type="number" id="maxDevices" name="maxDevices" min="1" max="20" placeholder="3">
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="planDescription">Description</label>
                        <textarea id="planDescription" name="planDescription" rows="3" placeholder="Description d√©taill√©e du plan..."></textarea>
                    </div>

                    <!-- Statut et visibilit√© -->
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="planStatus">Statut</label>
                            <select id="planStatus" name="planStatus">
                                <option value="active">Actif</option>
                                <option value="inactive">Inactif</option>
                                <option value="draft">Brouillon</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="checkbox-item">
                                <input type="checkbox" id="planFeatured" name="planFeatured">
                                <span>Plan mis en avant</span>
                            </label>
                        </div>
                    </div>
                </form>

                <!-- Boutons d'action -->
                <div class="modal-actions">
                    <button class="btn btn-secondary glass-btn" onclick="closeModal('createPlanModal')">Annuler</button>
                    <button class="btn btn-primary glass-btn glass-btn-primary" onclick="previewPlan()">üëÅÔ∏è Aper√ßu</button>
                    <button class="btn btn-success glass-btn glass-btn-success" onclick="createPlan()">‚úÖ Cr√©er le plan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================================
        // AUTHENTIFICATION ADMINISTRATEUR
        // ================================

        // V√©rifier l'authentification au chargement de la page
        function checkAdminAuth() {
            const token = localStorage.getItem('claudyne_token');
            const user = localStorage.getItem('claudyne_user');

            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    if (userData.role === 'ADMIN' && userData.userType === 'ADMIN') {
                        // Utilisateur admin authentifi√©
                        showAdminInterface();
                        return true;
                    }
                } catch (e) {
                    console.error('Erreur parsing user data:', e);
                }
            }

            // Pas d'authentification ou pas admin
            showLoginForm();
            return false;
        }

        function showAdminInterface() {
            document.getElementById('adminLoginForm').style.display = 'none';
            document.querySelector('.admin-container').classList.add('authenticated');
        }

        function showLoginForm() {
            document.getElementById('adminLoginForm').style.display = 'flex';
            document.querySelector('.admin-container').classList.remove('authenticated');
        }

        // Gestion du formulaire de connexion admin
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier l'auth au chargement
            checkAdminAuth();

            // Gestion du formulaire de connexion
            const adminAuthForm = document.getElementById('adminAuthForm');
            const loginBtn = document.getElementById('adminLoginBtn');
            const errorDiv = document.getElementById('adminLoginError');

            adminAuthForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;

                // Validation des champs
                if (!email || !password) {
                    showError('Veuillez saisir votre email et mot de passe');
                    return;
                }

                // Affichage loading
                loginBtn.disabled = true;
                loginBtn.textContent = 'üîê Connexion...';
                hideError();

                try {
                    // Appel API d'authentification
                    const response = await fetch('http://localhost:3001/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            credential: email,
                            password: password
                        })
                    });

                    const data = await response.json();

                    if (data.success && data.data.user.role === 'ADMIN') {
                        // Connexion admin r√©ussie
                        localStorage.setItem('claudyne_token', data.data.tokens.accessToken);
                        localStorage.setItem('claudyne_refresh_token', data.data.tokens.refreshToken);
                        localStorage.setItem('claudyne_user', JSON.stringify(data.data.user));

                        // Afficher l'interface admin
                        showAdminInterface();

                        // Message de bienvenue
                        console.log('üéâ Connexion admin r√©ussie!');
                    } else {
                        // Erreur d'authentification
                        if (data.data && data.data.user && data.data.user.role !== 'ADMIN') {
                            showError('Acc√®s refus√© : droits administrateur requis');
                        } else {
                            showError(data.message || 'Identifiants invalides');
                        }
                    }

                } catch (error) {
                    console.error('Erreur connexion admin:', error);
                    showError('Erreur de connexion. V√©rifiez votre connexion internet.');
                }

                // Restaurer le bouton
                loginBtn.disabled = false;
                loginBtn.textContent = 'Se connecter';
            });

            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }

            function hideError() {
                errorDiv.style.display = 'none';
            }
        });

        // Fonction de d√©connexion admin
        function adminLogout() {
            localStorage.removeItem('claudyne_token');
            localStorage.removeItem('claudyne_refresh_token');
            localStorage.removeItem('claudyne_user');
            localStorage.removeItem('claudyne_family');

            showLoginForm();
            console.log('üö™ D√©connexion admin effectu√©e');
        }

        // Fonctions pour la r√©cup√©ration de mot de passe
        function showForgotPassword() {
            document.getElementById('forgotPasswordModal').style.display = 'flex';
            document.getElementById('forgotEmail').focus();
        }

        function closeForgotPassword() {
            document.getElementById('forgotPasswordModal').style.display = 'none';
            document.getElementById('forgotPasswordForm').reset();
            hideForgotMessage();
        }

        function showForgotMessage(message, type) {
            const messageDiv = document.getElementById('forgotPasswordMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';

            if (type === 'success') {
                messageDiv.style.background = '#F0FDF4';
                messageDiv.style.border = '1px solid #BBF7D0';
                messageDiv.style.color = '#15803D';
            } else {
                messageDiv.style.background = '#FEF2F2';
                messageDiv.style.border = '1px solid #FECACA';
                messageDiv.style.color = '#DC2626';
            }
        }

        function hideForgotMessage() {
            document.getElementById('forgotPasswordMessage').style.display = 'none';
        }

        // Gestion du formulaire de r√©cup√©ration de mot de passe
        document.addEventListener('DOMContentLoaded', function() {
            const forgotForm = document.getElementById('forgotPasswordForm');
            const sendResetBtn = document.getElementById('sendResetBtn');

            forgotForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const email = document.getElementById('forgotEmail').value.trim();

                if (!email) {
                    showForgotMessage('Veuillez entrer votre email', 'error');
                    return;
                }

                // Loading state
                sendResetBtn.disabled = true;
                sendResetBtn.textContent = 'üìß Envoi en cours...';
                hideForgotMessage();

                try {
                    const response = await fetch('http://localhost:3001/api/auth/forgot-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email })
                    });

                    const data = await response.json();

                    if (data.success) {
                        showForgotMessage('üìß Email de r√©initialisation envoy√© ! V√©rifiez votre bo√Æte de r√©ception.', 'success');

                        // Fermer le modal apr√®s 3 secondes
                        setTimeout(() => {
                            closeForgotPassword();
                        }, 3000);
                    } else {
                        showForgotMessage(data.message || 'Erreur lors de l\'envoi de l\'email', 'error');
                    }

                } catch (error) {
                    console.error('Erreur r√©cup√©ration mot de passe:', error);
                    showForgotMessage('Erreur de connexion. Veuillez r√©essayer.', 'error');
                }

                // Restaurer le bouton
                sendResetBtn.disabled = false;
                sendResetBtn.textContent = 'Envoyer le lien';
            });

            // Fermer le modal en cliquant √† l'ext√©rieur
            document.getElementById('forgotPasswordModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeForgotPassword();
                }
            });
        });

        // D√©finir showSection dans la port√©e globale imm√©diatement
        window.showSection = function(sectionName) {
            console.log(`üîÑ Changement vers section: ${sectionName}`);
            console.log(`üìç URL avant: ${window.location.href}`);
            
            // Emp√™cher le comportement par d√©faut
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            currentSection = sectionName;
            
            // Masquer toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
                console.log(`  - Section ${section.id} masqu√©e`);
            });

            // Afficher la section demand√©e
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                
                // Initialiser les donn√©es sp√©cifiques √† la section
                if (sectionName === 'family-links') {
                    setTimeout(() => initializeFamilyLinksSection(), 100);
                }
                
                // Ajouter animation d'apparition
                targetSection.style.opacity = '0';
                setTimeout(() => {
                    targetSection.style.transition = 'opacity 0.3s ease';
                    targetSection.style.opacity = '1';
                }, 10);
                
                console.log(`‚úÖ Section ${sectionName} affich√©e`);
            } else {
                console.error(`‚ùå Section ${sectionName}-section non trouv√©e`);
                return false;
            }

            // Mettre √† jour la navigation - retirer active de tous les liens
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Ajouter active au lien cliqu√©
            if (event && event.target) {
                const clickedLink = event.target.closest('.nav-link');
                if (clickedLink) {
                    clickedLink.classList.add('active');
                    console.log(`‚úÖ Navigation mise √† jour - lien actif: ${clickedLink.textContent.trim()}`);
                }
            }
            
            // Charger les donn√©es de la section si la fonction existe
            if (typeof loadSectionData === 'function') {
                loadSectionData(sectionName);
            }
            
            console.log(`üìç URL apr√®s: ${window.location.href}`);
            return false;
        };

        const API_BASE = 'http://localhost:3001';
        let USE_MOCK_DATA = false; // VRAI BACKEND ACTIV√â - Donn√©es r√©elles depuis l'API
        
        // Backend r√©el activ√© - donn√©es authentiques
        console.log('üöÄ BACKEND R√âEL ACTIV√â - Interface connect√©e aux vraies APIs');
        console.log('üì° Connexion √† l\'API backend sur http://localhost:3001');
        
        // V√©rifier si l'API backend est disponible (d√©sactiv√© en mode d√©mo)
        async function checkBackendAvailability() {
            try {
                const response = await fetch(`${API_BASE}/health`, { timeout: 5000 });
                if (response.ok) {
                    console.log('‚úÖ Backend disponible - Utilisation des donn√©es r√©elles');
                    USE_MOCK_DATA = false;
                } else {
                    console.log('‚ö†Ô∏è Backend indisponible - Basculement vers les donn√©es simul√©es');
                    USE_MOCK_DATA = true;
                }
            } catch (error) {
                console.log('‚ùå Erreur connexion backend - Utilisation des donn√©es simul√©es');
                console.error('D√©tails:', error.message);
                USE_MOCK_DATA = true;
            }
        }
        
        // Initialiser la v√©rification backend
        checkBackendAvailability();
        let currentSection = 'dashboard';
        
        // Detection des erreurs JavaScript
        window.addEventListener('error', function(e) {
            console.error('‚ùå Erreur JavaScript:', e.error);
            console.error('‚ùå Fichier:', e.filename, 'Ligne:', e.lineno);
        });

        // V√©rification que showSection est bien d√©finie
        console.log('‚úÖ showSection d√©finie:', typeof window.showSection);
        console.log('‚úÖ showSection accessible:', typeof showSection);

        // showSection maintenant d√©finie dans window au d√©but

        // Gestion du dropdown "Ajouter contenu"
        document.addEventListener('DOMContentLoaded', function() {
            const addContentBtn = document.getElementById('addContentBtn');
            const dropdown = document.getElementById('addContentDropdown');
            
            if (addContentBtn && dropdown) {
                addContentBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const isVisible = dropdown.style.display !== 'none';
                    dropdown.style.display = isVisible ? 'none' : 'block';
                });
                
                // Fermer le dropdown en cliquant ailleurs
                document.addEventListener('click', function(e) {
                    if (!addContentBtn.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.style.display = 'none';
                    }
                });
            }
        });

        // Navigation entre sections
        // Function supprim√©e - utilise la version am√©lior√©e plus bas

        // Chargement des donn√©es par section
        async function loadSectionData(section) {
            try {
                console.log(`üìä Chargement des donn√©es pour la section: ${section}`);
                
                switch (section) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'users':
                        await loadUsersData();
                        break;
                    case 'content':
                        await loadContentData();
                        break;
                    case 'payments':
                        await loadPaymentsData();
                        break;
                    case 'analytics':
                        await loadAnalyticsData();
                        break;
                    case 'free-modules':
                        await loadFreeModulesData();
                        break;
                    case 'trial-management':
                        await loadTrialManagementData();
                        break;
                    case 'roles-management':
                        await loadRolesManagementData();
                        break;
                    case 'staff-management':
                        await loadStaffManagementData();
                        break;
                    case 'communication':
                        await loadCommunicationData();
                        break;
                    case 'reports':
                        await loadReportsData();
                        break;
                    case 'system-monitoring':
                        await loadSystemMonitoringData();
                        break;
                    case 'pricing-plans':
                        await loadPricingPlansData();
                        break;
                    case 'settings':
                        await loadSettingsData();
                        break;
                    default:
                        console.log(`‚úÖ Section ${section} charg√©e (pas de donn√©es sp√©cifiques)`);
                }
                
                console.log(`‚úÖ Donn√©es charg√©es pour ${section}`);
            } catch (error) {
                console.warn(`‚ö†Ô∏è Erreur lors du chargement des donn√©es pour ${section}:`, error);
                // Continuer l'ex√©cution m√™me en cas d'erreur - mode d√©veloppement
            }
        }

        // Dashboard Data
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/dashboard`);
                const data = await response.json();

                if (data.success) {
                    // Mise √† jour des statistiques
                    document.getElementById('active-families').textContent = data.data.stats.activeFamilies;
                    document.getElementById('active-students').textContent = data.data.stats.activeStudents;
                    document.getElementById('monthly-revenue').textContent = formatCurrency(data.data.stats.monthlyRevenue);
                    document.getElementById('quizzes-taken').textContent = data.data.stats.quizzesTaken;

                    // Activit√© r√©cente
                    const activityHtml = data.data.recentActivity.map(activity => `
                        <div style="padding: 0.75rem 0; border-bottom: 1px solid #E5E7EB;">
                            <div style="font-weight: 500;">${activity.message}</div>
                            <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.25rem;">
                                ${formatDate(activity.timestamp)}
                            </div>
                        </div>
                    `).join('');

                    document.getElementById('recent-activity').innerHTML = activityHtml || '<p>Aucune activit√© r√©cente</p>';
                }
            } catch (error) {
                console.error('Erreur chargement dashboard:', error);
                document.getElementById('recent-activity').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Users Data
        async function loadUsersData() {
            try {
                if (USE_MOCK_DATA) {
                    console.log('‚úÖ Section Gestion des familles charg√©e (mode simulation)');
                    
                    // Afficher du contenu simul√© visible
                    const usersContainer = document.querySelector('#users-section .section-content');
                    if (usersContainer) {
                        usersContainer.innerHTML = `
                            <div style="padding: 2rem; text-align: center; background: rgba(255,255,255,0.1); border-radius: 12px; margin: 1rem 0;">
                                <h3 style="color: #1F2937; margin-bottom: 1rem;">üìä Donn√©es de Gestion des Familles (Mode D√©mo)</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #1F2937;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familles</h4>
                                        <p style="font-size: 2rem; font-weight: bold; color: #3B82F6;">248</p>
                                    </div>
                                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #1F2937;">üéì √âtudiants</h4>
                                        <p style="font-size: 2rem; font-weight: bold; color: #10B981;">832</p>
                                    </div>
                                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #1F2937;">üí∞ Abonnements</h4>
                                        <p style="font-size: 2rem; font-weight: bold; color: #F59E0B;">156</p>
                                    </div>
                                </div>
                                <p style="color: #6B7280; font-style: italic;">
                                    Interface pr√™te pour la production ! üöÄ<br>
                                    Les donn√©es r√©elles appara√Ætront une fois le backend connect√©.
                                </p>
                            </div>
                        `;
                    }
                    return;
                }
                
                const response = await fetch(`${API_BASE}/api/admin/users`);
                const data = await response.json();

                if (data.success) {
                    const usersHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID Abonn√©</th>
                                    <th>Type Compte</th>
                                    <th>Nom/Famille</th>
                                    <th>Contact</th>
                                    <th>Statut</th>
                                    <th>Abonnement</th>
                                    <th>Points Claudine</th>
                                    <th>Derni√®re activit√©</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.users.map(user => {
                                    const isFamily = user.subscriptionType.includes('family') || user.children > 1;
                                    const subscriberId = isFamily ? `FAM-${String(user.id).padStart(6, '0')}` : `IND-${String(user.id).padStart(6, '0')}`;
                                    const accountType = isFamily ? 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familial' : 'üë§ Individuel';
                                    const accountName = isFamily ? user.familyName : `${user.firstName} ${user.lastName}`;
                                    
                                    return `
                                    <tr>
                                        <td style="font-family: monospace; font-weight: bold; color: ${isFamily ? '#10B981' : '#3B82F6'};">${subscriberId}</td>
                                        <td>
                                            <span style="font-size: 0.875rem; font-weight: 500;">${accountType}</span>
                                        </td>
                                        <td>
                                            <div style="font-weight: 500;">${accountName}</div>
                                            ${isFamily ? `<div style="font-size: 0.75rem; color: #6B7280;">${user.firstName} ${user.lastName} (Responsable)</div>` : `<div style="font-size: 0.75rem; color: #6B7280;">Compte personnel</div>`}
                                        </td>
                                        <td>
                                            <div style="font-size: 0.875rem;">${user.email}</div>
                                            <div style="font-size: 0.75rem; color: #6B7280;">${user.phone}</div>
                                        </td>
                                        <td>
                                            <span class="status-badge ${user.status}">${getStatusLabel(user.status)}</span>
                                        </td>
                                        <td>
                                            <span class="status-badge ${user.subscriptionType}">${getSubscriptionLabel(user.subscriptionType)}</span>
                                            ${isFamily ? `<div style="font-size: 0.75rem; color: #6B7280;">${user.children} enfant(s)</div>` : ''}
                                        </td>
                                        <td style="font-weight: 600; color: #F59E0B;">${user.totalClaudinePoints}</td>
                                        <td style="font-size: 0.75rem; color: #6B7280;">${formatDate(user.lastActivity)}</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="editSubscriber('${user.id}', '${isFamily ? 'family' : 'individual'}')">Modifier</button>
                                            <button class="btn btn-warning btn-sm" onclick="manageTrialPeriod('${user.id}')">Essai</button>
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('users-table').innerHTML = usersHtml;
                }
            } catch (error) {
                console.error('Erreur chargement users:', error);
                document.getElementById('users-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Content Data with Tabs
        async function loadContentData() {
            await loadCoursesData();
            await loadQuizzesData();
            await loadResourcesData();
        }

        // Load Courses Data
        async function loadCoursesData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/content`);
                const data = await response.json();

                if (data.success) {
                    const coursesHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Mati√®re</th>
                                    <th>Le√ßons</th>
                                    <th>√âtudiants</th>
                                    <th>Score moyen</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.subjects.map(subject => `
                                    <tr>
                                        <td style="font-weight: 500;">${subject.title}</td>
                                        <td>${subject.lessons}</td>
                                        <td>${subject.students}</td>
                                        <td style="font-weight: 600; color: #10B981;">${subject.averageScore}%</td>
                                        <td>
                                            <span class="status-badge ${subject.status}">${getStatusLabel(subject.status)}</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm">Modifier</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('courses-table').innerHTML = coursesHtml;
                }
            } catch (error) {
                console.error('Erreur chargement courses:', error);
                document.getElementById('courses-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Load Quizzes Data
        async function loadQuizzesData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/content`);
                const data = await response.json();
                const quizzes = data.success ? data.data.quizzes : [];
                
                const quizzesHtml = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Titre Quiz</th>
                                <th>Mati√®re</th>
                                <th>Questions</th>
                                <th>Tentatives</th>
                                <th>Score moyen</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="font-weight: 500;">Quiz: Introduction aux nombres</td>
                                <td>Math√©matiques 6√®me</td>
                                <td>3</td>
                                <td>156</td>
                                <td style="font-weight: 600; color: #10B981;">78%</td>
                                <td><span class="status-badge active">Actif</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm">Modifier</button>
                                    <button class="btn btn-danger btn-sm">D√©sactiver</button>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: 500;">Quiz: Conjugaison pr√©sent</td>
                                <td>Fran√ßais 6√®me</td>
                                <td>5</td>
                                <td>123</td>
                                <td style="font-weight: 600; color: #10B981;">82%</td>
                                <td><span class="status-badge active">Actif</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm">Modifier</button>
                                    <button class="btn btn-danger btn-sm">D√©sactiver</button>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: 500;">Quiz: Les 10 r√©gions</td>
                                <td>G√©ographie 6√®me</td>
                                <td>10</td>
                                <td>89</td>
                                <td style="font-weight: 600; color: #F59E0B;">65%</td>
                                <td><span class="status-badge pending">En r√©vision</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm">Modifier</button>
                                    <button class="btn btn-success btn-sm">Activer</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                `;

                document.getElementById('quizzes-table').innerHTML = quizzesHtml;
            } catch (error) {
                console.error('Erreur chargement quizzes:', error);
                document.getElementById('quizzes-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Load Resources Data
        async function loadResourcesData() {
            try {
                // Simulate resources data
                const resourcesHtml = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Titre Ressource</th>
                                <th>Type</th>
                                <th>Mati√®re</th>
                                <th>Taille</th>
                                <th>T√©l√©chargements</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="font-weight: 500;">Manuel Math√©matiques 6√®me</td>
                                <td>üìö PDF</td>
                                <td>Math√©matiques</td>
                                <td>2.5 MB</td>
                                <td>234</td>
                                <td><span class="status-badge active">Actif</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm">Modifier</button>
                                    <button class="btn btn-info btn-sm">T√©l√©charger</button>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: 500;">Vid√©o: Les fractions</td>
                                <td>üé• MP4</td>
                                <td>Math√©matiques</td>
                                <td>15.2 MB</td>
                                <td>189</td>
                                <td><span class="status-badge active">Actif</span></td>
                                <td>
                                    <button class="btn btn-secondary btn-sm">Modifier</button>
                                    <button class="btn btn-info btn-sm">Visionner</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                `;

                document.getElementById('resources-table').innerHTML = resourcesHtml;
            } catch (error) {
                console.error('Erreur chargement resources:', error);
                document.getElementById('resources-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Payments Data
        async function loadPaymentsData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/payments`);
                const data = await response.json();

                if (data.success) {
                    const paymentsHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID Transaction</th>
                                    <th>Famille</th>
                                    <th>Montant</th>
                                    <th>M√©thode</th>
                                    <th>Plan</th>
                                    <th>Statut</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.transactions.map(tx => `
                                    <tr>
                                        <td style="font-family: monospace; font-size: 0.75rem;">${tx.id}</td>
                                        <td style="font-weight: 500;">${tx.familyName}</td>
                                        <td style="font-weight: 600; color: #10B981;">${formatCurrency(tx.amount)}</td>
                                        <td>${getPaymentMethodLabel(tx.method)}</td>
                                        <td>${tx.planName}</td>
                                        <td>
                                            <span class="status-badge ${tx.status}">${getStatusLabel(tx.status)}</span>
                                        </td>
                                        <td style="font-size: 0.75rem;">${formatDate(tx.transactionDate)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('payments-table').innerHTML = paymentsHtml;
                }
            } catch (error) {
                console.error('Erreur chargement payments:', error);
                document.getElementById('payments-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Analytics Data
        async function loadAnalyticsData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/analytics`);
                const data = await response.json();

                if (data.success) {
                    // Graphique de croissance
                    const maxUsers = Math.max(...data.data.userGrowth.map(item => item.users));
                    const chartHtml = data.data.userGrowth.map(item => `
                        <div class="chart-bar" style="height: ${(item.users / maxUsers) * 200}px;" title="${item.users} utilisateurs en ${item.month}">
                            <div class="chart-label">${item.month.substring(0, 3)}</div>
                        </div>
                    `).join('');

                    document.getElementById('user-growth-chart').innerHTML = chartHtml;

                    // Statistiques r√©gionales
                    const regionalHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>R√©gion</th>
                                    <th>Familles</th>
                                    <th>Revenus</th>
                                    <th>Moyenne par famille</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.regionalStats.map(region => `
                                    <tr>
                                        <td style="font-weight: 500;">${region.region}</td>
                                        <td>${region.families}</td>
                                        <td style="font-weight: 600; color: #10B981;">${formatCurrency(region.revenue)}</td>
                                        <td>${formatCurrency(Math.round(region.revenue / region.families))}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('regional-stats').innerHTML = regionalHtml;
                }
            } catch (error) {
                console.error('Erreur chargement analytics:', error);
                document.getElementById('user-growth-chart').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
                document.getElementById('regional-stats').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Settings Data
        async function loadSettingsData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/settings`);
                const data = await response.json();

                if (data.success) {
                    const settings = data.data;
                    const settingsHtml = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <div>
                                <h3 style="margin-bottom: 1rem; color: #1F2937;">Informations plateforme</h3>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nom du site</label>
                                    <input type="text" value="${settings.platform.siteName}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Slogan</label>
                                    <input type="text" value="${settings.platform.tagline}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email de support</label>
                                    <input type="email" value="${settings.platform.supportEmail}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                            </div>

                            <div>
                                <h3 style="margin-bottom: 1rem; color: #1F2937;">Tarification</h3>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Plan Basique (FCFA)</label>
                                    <input type="number" value="${settings.pricing.basicMonthly}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Plan Premium (FCFA)</label>
                                    <input type="number" value="${settings.pricing.premiumMonthly}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Plan Famille Annuel (FCFA)</label>
                                    <input type="number" value="${settings.pricing.familyYearly}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                            </div>

                            <div>
                                <h3 style="margin-bottom: 1rem; color: #1F2937;">Fonctionnalit√©s</h3>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" ${settings.features.claudinePointsEnabled ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        Points Claudine activ√©s
                                    </label>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" ${settings.features.achievementsEnabled ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        R√©compenses activ√©es
                                    </label>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Dur√©e d'essai (jours)</label>
                                    <input type="number" value="${settings.features.trialDurationDays}" style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 6px;">
                                </div>
                            </div>
                        </div>
                    `;

                    const settingsForm = document.getElementById('settings-form');
                    if (settingsForm) {
                        settingsForm.innerHTML = settingsHtml;
                    } else {
                        console.warn('Element settings-form non trouv√©');
                    }
                }
            } catch (error) {
                console.error('Erreur chargement settings:', error);
                const settingsForm = document.getElementById('settings-form');
                if (settingsForm) {
                    settingsForm.innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
                }
            }
        }

        // Free Modules Data
        async function loadFreeModulesData() {
            try {
                if (USE_MOCK_DATA) {
                    console.log('‚úÖ Section Modules gratuits charg√©e (mode simulation)');
                    
                    // Afficher du contenu simul√© visible
                    const freeModulesContainer = document.querySelector('#free-modules-section .section-content');
                    if (freeModulesContainer) {
                        freeModulesContainer.innerHTML = `
                            <div style="padding: 2rem; text-align: center; background: rgba(255,255,255,0.1); border-radius: 12px; margin: 1rem 0;">
                                <h3 style="color: #1F2937; margin-bottom: 1rem;">üÜì Modules Gratuits (Mode D√©mo)</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #1F2937;">üìö Math√©matiques de base</h4>
                                        <p style="color: #6B7280;">Calcul, g√©om√©trie, alg√®bre</p>
                                        <div style="background: #10B981; color: white; padding: 0.5rem; border-radius: 4px; margin-top: 1rem;">‚úÖ Actif</div>
                                    </div>
                                    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #1F2937;">üá´üá∑ Fran√ßais niveau 1</h4>
                                        <p style="color: #6B7280;">Grammaire, conjugaison</p>
                                        <div style="background: #10B981; color: white; padding: 0.5rem; border-radius: 4px; margin-top: 1rem;">‚úÖ Actif</div>
                                    </div>
                                    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #1F2937;">üî¨ Sciences d√©couverte</h4>
                                        <p style="color: #6B7280;">Biologie, physique-chimie</p>
                                        <div style="background: #10B981; color: white; padding: 0.5rem; border-radius: 4px; margin-top: 1rem;">‚úÖ Actif</div>
                                    </div>
                                </div>
                                <p style="color: #6B7280; font-style: italic;">
                                    üéØ 3 modules gratuits disponibles en permanence<br>
                                    Interface pr√™te pour la gestion en production !
                                </p>
                            </div>
                        `;
                    }
                    return;
                }
                
                const response = await fetch(`${API_BASE}/api/admin/free-modules`);
                const data = await response.json();

                if (data.success) {
                    const freeModulesHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Mati√®re</th>
                                    <th>Le√ßons gratuites</th>
                                    <th>Quiz gratuits</th>
                                    <th>Niveau d'acc√®s</th>
                                    <th>Derni√®re modification</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.freeModules.map(module => `
                                    <tr>
                                        <td style="font-weight: 500;">${module.subject}</td>
                                        <td>${module.freeLessons}</td>
                                        <td>${module.freeQuizzes}</td>
                                        <td>
                                            <span class="status-badge ${module.accessLevel}">${module.accessLevel}</span>
                                        </td>
                                        <td style="font-size: 0.75rem; color: #6B7280;">${formatDate(module.lastModified)}</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="editFreeModule('${module.subjectId}')">Modifier</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('free-modules-table').innerHTML = freeModulesHtml;
                }
            } catch (error) {
                console.error('Erreur chargement free modules:', error);
                document.getElementById('free-modules-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement des modules gratuits</p>';
            }
        }

        // Trial Management Data
        async function loadTrialManagementData() {
            try {
                // Load trial statistics
                const statsResponse = await fetch(`${API_BASE}/api/admin/trial-stats`);
                const statsData = await statsResponse.json();

                if (statsData.success) {
                    document.getElementById('total-extensions').textContent = statsData.data.totalExtensions;
                    document.getElementById('avg-extension-days').textContent = statsData.data.averageExtensionDays;
                    document.getElementById('active-extensions').textContent = statsData.data.activeExtensions;
                }

                // Load trial extensions history
                const historyResponse = await fetch(`${API_BASE}/api/admin/trial-history`);
                const historyData = await historyResponse.json();

                if (historyData.success) {
                    const historyHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Famille</th>
                                    <th>Jours √©tendus</th>
                                    <th>Nouvelle expiration</th>
                                    <th>Raison</th>
                                    <th>Date d'extension</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${historyData.data.extensions.map(ext => `
                                    <tr>
                                        <td style="font-weight: 500;">${ext.familyName}</td>
                                        <td style="font-weight: 600; color: #10B981;">+${ext.daysExtended}</td>
                                        <td style="font-size: 0.875rem;">${formatDate(ext.newExpirationDate)}</td>
                                        <td style="font-size: 0.875rem;">${ext.reason}</td>
                                        <td style="font-size: 0.75rem; color: #6B7280;">${formatDate(ext.extensionDate)}</td>
                                        <td>
                                            <span class="status-badge ${ext.status}">${getStatusLabel(ext.status)}</span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('trial-history-table').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Erreur chargement trial management:', error);
                document.getElementById('trial-history-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement de l\'historique</p>';
            }
        }

        // Extend Trial Function
        async function extendTrial() {
            const familyId = document.getElementById('familyId').value;
            const trialDays = document.getElementById('newTrialDays').value;
            const reason = document.getElementById('trialReason').value;
            const resultDiv = document.getElementById('trial-extension-result');

            if (!familyId || !trialDays || !reason) {
                showTrialResult('‚ùå Veuillez remplir tous les champs', 'error');
                return;
            }

            try {
                showTrialResult('‚è≥ Extension de l\'essai en cours...', 'info');

                const response = await fetch(`${API_BASE}/api/admin/users/${familyId}/trial`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        trialDays: parseInt(trialDays),
                        reason: reason
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showTrialResult(
                        `‚úÖ Essai √©tendu avec succ√®s !<br>
                        Famille ID: ${data.data.userId}<br>
                        Nouveaux jours: ${data.data.trialDaysUpdated}<br>
                        Nouvelle expiration: ${formatDate(data.data.newExpirationDate)}`, 
                        'success'
                    );

                    // Reset form
                    document.getElementById('familyId').value = '';
                    document.getElementById('newTrialDays').value = '14';
                    document.getElementById('trialReason').value = '';

                    // Reload trial management data
                    await loadTrialManagementData();
                } else {
                    showTrialResult(`‚ùå Erreur: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Erreur extension essai:', error);
                showTrialResult('‚ùå Erreur de connexion au serveur', 'error');
            }
        }

        // Show trial extension result
        function showTrialResult(message, type) {
            const resultDiv = document.getElementById('trial-extension-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = message;
            
            if (type === 'success') {
                resultDiv.style.backgroundColor = '#D1FAE5';
                resultDiv.style.color = '#065F46';
                resultDiv.style.border = '1px solid #A7F3D0';
            } else if (type === 'error') {
                resultDiv.style.backgroundColor = '#FEE2E2';
                resultDiv.style.color = '#991B1B';
                resultDiv.style.border = '1px solid #FECACA';
            } else {
                resultDiv.style.backgroundColor = '#DBEAFE';
                resultDiv.style.color = '#1E40AF';
                resultDiv.style.border = '1px solid #93C5FD';
            }

            // Auto-hide after 5 seconds for non-error messages
            if (type !== 'error') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Save Free Module Settings
        async function saveFreeModuleSettings() {
            const settings = {
                maxFreeLessons: parseInt(document.getElementById('maxFreeLessons').value),
                maxFreeQuizzes: parseInt(document.getElementById('maxFreeQuizzes').value),
                durationLimit: parseInt(document.getElementById('durationLimit').value),
                allowProgressTracking: document.getElementById('allowProgressTracking').checked
            };

            try {
                const response = await fetch(`${API_BASE}/api/admin/free-modules/settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                const data = await response.json();

                if (data.success) {
                    // Show success message
                    const button = event.target;
                    const originalText = button.textContent;
                    button.textContent = '‚úÖ Sauvegard√© !';
                    button.style.backgroundColor = '#10B981';
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.backgroundColor = '';
                    }, 2000);
                } else {
                    alert('‚ùå Erreur lors de la sauvegarde: ' + data.message);
                }
            } catch (error) {
                console.error('Erreur sauvegarde settings:', error);
                alert('‚ùå Erreur de connexion au serveur');
            }
        }

        // Edit Free Module
        async function editFreeModule(subjectId) {
            // This could open a modal or navigate to an edit page
            alert(`Edition du module ${subjectId} - Fonctionnalit√© √† impl√©menter`);
        }

        // Communication Data
        async function loadCommunicationData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/messages/history`);
                const data = await response.json();

                if (data.success) {
                    const historyHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Destinataires</th>
                                    <th>Objet</th>
                                    <th>Type</th>
                                    <th>Statut</th>
                                    <th>Taux d'ouverture</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.messages.map(msg => `
                                    <tr>
                                        <td style="font-size: 0.75rem;">${formatDate(msg.sentDate)}</td>
                                        <td>${msg.recipientsCount} abonn√©s</td>
                                        <td style="font-weight: 500;">${msg.subject}</td>
                                        <td>
                                            <span class="status-badge ${msg.type}">${msg.type}</span>
                                        </td>
                                        <td>
                                            <span class="status-badge ${msg.status}">${getStatusLabel(msg.status)}</span>
                                        </td>
                                        <td style="color: #10B981; font-weight: 600;">${msg.openRate}%</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewMessageDetails('${msg.id}')">D√©tails</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('message-history-table').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('Erreur chargement communication:', error);
                document.getElementById('message-history-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Send Message
        async function sendMessage() {
            const messageData = {
                recipients: document.getElementById('messageRecipients').value,
                type: document.getElementById('messageType').value,
                subject: document.getElementById('messageSubject').value,
                content: document.getElementById('messageContent').value,
                scheduled: document.getElementById('scheduleMessage').checked
            };

            if (!messageData.subject || !messageData.content) {
                showMessageResult('‚ùå Veuillez remplir l\'objet et le contenu', 'error');
                return;
            }

            try {
                showMessageResult('üì§ Envoi du message en cours...', 'info');

                const response = await fetch(`${API_BASE}/api/admin/messages/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(messageData)
                });

                const data = await response.json();

                if (data.success) {
                    showMessageResult(`‚úÖ Message envoy√© avec succ√®s √† ${data.data.sentCount} familles !`, 'success');
                    
                    // Reset form
                    document.getElementById('messageSubject').value = '';
                    document.getElementById('messageContent').value = '';
                    
                    // Reload message history
                    await loadCommunicationData();
                } else {
                    showMessageResult(`‚ùå Erreur: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Erreur envoi message:', error);
                showMessageResult('‚ùå Erreur de connexion au serveur', 'error');
            }
        }

        // Preview Message
        function previewMessage() {
            const subject = document.getElementById('messageSubject').value;
            const content = document.getElementById('messageContent').value;
            
            if (!subject || !content) {
                alert('‚ö†Ô∏è Veuillez remplir l\'objet et le contenu pour pr√©visualiser');
                return;
            }

            const previewWindow = window.open('', '_blank', 'width=600,height=400');
            previewWindow.document.write(`
                <html>
                <head>
                    <title>Aper√ßu du message</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 2rem; background: #f5f5f5; }
                        .email-preview { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                        .subject { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; color: #333; }
                        .content { line-height: 1.6; color: #555; }
                    </style>
                </head>
                <body>
                    <div class="email-preview">
                        <div class="subject">${subject}</div>
                        <div class="content">${content.replace(/\n/g, '<br>')}</div>
                    </div>
                </body>
                </html>
            `);
        }

        // Show message result
        function showMessageResult(message, type) {
            const resultDiv = document.getElementById('message-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = message;
            
            if (type === 'success') {
                resultDiv.style.backgroundColor = '#D1FAE5';
                resultDiv.style.color = '#065F46';
                resultDiv.style.border = '1px solid #A7F3D0';
            } else if (type === 'error') {
                resultDiv.style.backgroundColor = '#FEE2E2';
                resultDiv.style.color = '#991B1B';
                resultDiv.style.border = '1px solid #FECACA';
            } else {
                resultDiv.style.backgroundColor = '#DBEAFE';
                resultDiv.style.color = '#1E40AF';
                resultDiv.style.border = '1px solid #93C5FD';
            }

            if (type !== 'error') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Reports Data
        async function loadReportsData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/scheduled-reports`);
                const data = await response.json();

                if (data.success) {
                    const reportsHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Fr√©quence</th>
                                    <th>Format</th>
                                    <th>Derni√®re ex√©cution</th>
                                    <th>Prochaine ex√©cution</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.reports.map(report => `
                                    <tr>
                                        <td style="font-weight: 500;">${report.type}</td>
                                        <td>${report.frequency}</td>
                                        <td style="text-transform: uppercase;">${report.format}</td>
                                        <td style="font-size: 0.75rem;">${formatDate(report.lastRun)}</td>
                                        <td style="font-size: 0.75rem;">${formatDate(report.nextRun)}</td>
                                        <td>
                                            <span class="status-badge ${report.status}">${getStatusLabel(report.status)}</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="runReport('${report.id}')">‚ñ∂Ô∏è Ex√©cuter</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('scheduled-reports-table').innerHTML = reportsHtml;
                }
            } catch (error) {
                console.error('Erreur chargement reports:', error);
                document.getElementById('scheduled-reports-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement</p>';
            }
        }

        // Generate Report
        async function generateReport() {
            const reportData = {
                type: document.getElementById('reportType').value,
                period: document.getElementById('reportPeriod').value,
                format: document.getElementById('reportFormat').value
            };

            try {
                showReportResult('üìä G√©n√©ration du rapport en cours...', 'info');

                const response = await fetch(`${API_BASE}/api/admin/reports/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                });

                const data = await response.json();

                if (data.success) {
                    showReportResult(`‚úÖ Rapport g√©n√©r√© avec succ√®s ! <a href="${data.data.downloadUrl}" target="_blank" style="color: #10B981; text-decoration: underline;">üì• T√©l√©charger</a>`, 'success');
                } else {
                    showReportResult(`‚ùå Erreur: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Erreur g√©n√©ration rapport:', error);
                showReportResult('‚ùå Erreur de connexion au serveur', 'error');
            }
        }

        // Show report result
        function showReportResult(message, type) {
            const resultDiv = document.getElementById('report-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = message;
            
            if (type === 'success') {
                resultDiv.style.backgroundColor = '#D1FAE5';
                resultDiv.style.color = '#065F46';
                resultDiv.style.border = '1px solid #A7F3D0';
            } else if (type === 'error') {
                resultDiv.style.backgroundColor = '#FEE2E2';
                resultDiv.style.color = '#991B1B';
                resultDiv.style.border = '1px solid #FECACA';
            } else {
                resultDiv.style.backgroundColor = '#DBEAFE';
                resultDiv.style.color = '#1E40AF';
                resultDiv.style.border = '1px solid #93C5FD';
            }

            if (type !== 'error') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 8000);
            }
        }

        // System Monitoring Data
        async function loadSystemMonitoringData() {
            try {
                // Load system health
                const healthResponse = await fetch(`${API_BASE}/api/admin/system/health`);
                const healthData = await healthResponse.json();

                if (healthData.success) {
                    const health = healthData.data;
                    document.getElementById('uptime-display').textContent = formatUptime(health.uptime);
                    document.getElementById('cpu-usage').textContent = health.cpu;
                    document.getElementById('memory-usage').textContent = health.memory;
                    document.getElementById('error-count').textContent = health.errors;
                    
                    // Update server status indicator
                    const statusIcon = document.getElementById('server-status');
                    if (health.status === 'healthy') {
                        statusIcon.textContent = 'üü¢';
                    } else if (health.status === 'warning') {
                        statusIcon.textContent = 'üü°';
                    } else {
                        statusIcon.textContent = 'üî¥';
                    }
                }

                // Load system logs
                const logsResponse = await fetch(`${API_BASE}/api/admin/system/logs`);
                const logsData = await logsResponse.json();

                if (logsData.success) {
                    const logsHtml = logsData.data.logs.map(log => {
                        const levelColor = {
                            'INFO': '#10B981',
                            'WARN': '#F59E0B',
                            'ERROR': '#EF4444',
                            'DEBUG': '#6B7280'
                        };
                        
                        return `<div style="margin-bottom: 0.25rem;">
                            <span style="color: ${levelColor[log.level] || '#F3F4F6'};">[${log.timestamp}]</span>
                            <span style="color: ${levelColor[log.level] || '#F3F4F6'}; font-weight: bold;">${log.level}</span>
                            <span style="color: #F3F4F6;">${log.message}</span>
                        </div>`;
                    }).join('');

                    document.getElementById('system-logs').innerHTML = logsHtml;
                }

                // Load backup status
                const backupResponse = await fetch(`${API_BASE}/api/admin/system/backups`);
                const backupData = await backupResponse.json();

                if (backupData.success) {
                    const backupsHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Derni√®re sauvegarde</th>
                                    <th>Taille</th>
                                    <th>Statut</th>
                                    <th>Prochaine</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${backupData.data.backups.map(backup => `
                                    <tr>
                                        <td style="font-weight: 500;">${backup.type}</td>
                                        <td style="font-size: 0.75rem;">${formatDate(backup.lastBackup)}</td>
                                        <td>${formatFileSize(backup.size)}</td>
                                        <td>
                                            <span class="status-badge ${backup.status}">${getStatusLabel(backup.status)}</span>
                                        </td>
                                        <td style="font-size: 0.75rem;">${formatDate(backup.nextBackup)}</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="downloadBackup('${backup.id}')">‚¨áÔ∏è T√©l√©charger</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('backup-status-table').innerHTML = backupsHtml;
                }
            } catch (error) {
                console.error('Erreur chargement monitoring:', error);
                document.getElementById('system-logs').innerHTML = '<div style="color: #EF4444;">‚ùå Erreur de chargement des logs</div>';
            }
        }

        // Refresh Logs
        async function refreshLogs() {
            document.getElementById('system-logs').innerHTML = '<div class="loading" style="color: #F3F4F6;"></div> Actualisation des logs...';
            await loadSystemMonitoringData();
        }

        // Trigger Backup
        async function triggerBackup() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/system/backup`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Sauvegarde lanc√©e avec succ√®s !');
                    await loadSystemMonitoringData();
                } else {
                    alert('‚ùå Erreur: ' + data.message);
                }
            } catch (error) {
                console.error('Erreur backup:', error);
                alert('‚ùå Erreur de connexion au serveur');
            }
        }

        // Utility functions for monitoring
        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${days}j ${hours}h ${minutes}m`;
        }

        function formatFileSize(bytes) {
            const sizes = ['B', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 B';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Additional utility functions
        function viewMessageDetails(messageId) {
            alert(`D√©tails du message ${messageId} - Fonctionnalit√© √† impl√©menter`);
        }

        function runReport(reportId) {
            alert(`Ex√©cution du rapport ${reportId} - Fonctionnalit√© √† impl√©menter`);
        }

        function scheduleNewReport() {
            alert('Planification d\'un nouveau rapport - Fonctionnalit√© √† impl√©menter');
        }

        function downloadBackup(backupId) {
            alert(`T√©l√©chargement de la sauvegarde ${backupId} - Fonctionnalit√© √† impl√©menter`);
        }

        // Roles Management Data
        async function loadRolesManagementData() {
            try {
                if (USE_MOCK_DATA) {
                    // Utiliser des donn√©es simul√©es
                    const mockData = {
                        success: true,
                        data: {
                            counts: {
                                admin: 3,
                                teacher: 24,
                                moderator: 8,
                                validator: 12
                            }
                        }
                    };
                    
                    // Update role counts avec donn√©es simul√©es
                    document.getElementById('admin-count').textContent = mockData.data.counts.admin;
                    document.getElementById('teacher-count').textContent = mockData.data.counts.teacher;
                    document.getElementById('moderator-count').textContent = mockData.data.counts.moderator;
                    document.getElementById('validator-count').textContent = mockData.data.counts.validator;
                    
                    console.log('‚úÖ Donn√©es de r√¥les charg√©es (mode simulation)');
                    return;
                }
                
                const response = await fetch(`${API_BASE}/api/admin/roles`);
                const data = await response.json();

                if (data.success) {
                    // Update role counts
                    document.getElementById('admin-count').textContent = data.data.counts.admin;
                    document.getElementById('teacher-count').textContent = data.data.counts.teacher;
                    document.getElementById('moderator-count').textContent = data.data.counts.moderator;
                    document.getElementById('validator-count').textContent = data.data.counts.validator;

                    // Load roles table
                    const rolesHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>R√¥le</th>
                                    <th>Niveau</th>
                                    <th>Utilisateurs</th>
                                    <th>Permissions cl√©s</th>
                                    <th>Cr√©√© le</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.roles.map(role => `
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span>${role.icon}</span>
                                                <div>
                                                    <div style="font-weight: 500;">${role.name}</div>
                                                    <div style="font-size: 0.75rem; color: #6B7280;">${role.description}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="status-badge ${role.level <= 2 ? 'danger' : role.level <= 4 ? 'warning' : 'secondary'}">
                                                Niveau ${role.level}
                                            </span>
                                        </td>
                                        <td style="font-weight: 600; color: #10B981;">${role.userCount}</td>
                                        <td>
                                            <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">
                                                ${role.keyPermissions.map(perm => `<span style="background: #F3F4F6; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.625rem;">${perm}</span>`).join('')}
                                            </div>
                                        </td>
                                        <td style="font-size: 0.75rem; color: #6B7280;">${formatDate(role.createdAt)}</td>
                                        <td>
                                            <span class="status-badge ${role.status}">${getStatusLabel(role.status)}</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="editRole('${role.id}')">‚úèÔ∏è Modifier</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('roles-table').innerHTML = rolesHtml;
                }
            } catch (error) {
                console.error('Erreur chargement roles:', error);
                document.getElementById('roles-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement des r√¥les</p>';
            }
        }

        // Staff Management Data
        async function loadStaffManagementData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/staff`);
                const data = await response.json();

                if (data.success) {
                    // Update staff counts
                    document.getElementById('total-staff').textContent = data.data.stats.total;
                    document.getElementById('active-staff-today').textContent = data.data.stats.activeToday;
                    document.getElementById('staff-in-training').textContent = data.data.stats.inTraining;
                    document.getElementById('staff-evaluations').textContent = data.data.stats.pendingEvaluations;

                    // Load staff directory
                    const staffHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Personnel</th>
                                    <th>R√¥le</th>
                                    <th>Sp√©cialit√©</th>
                                    <th>R√©gion</th>
                                    <th>Performance</th>
                                    <th>Derni√®re activit√©</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.staff.map(member => `
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #10B981, #3B82F6); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">
                                                    ${member.firstName.charAt(0)}${member.lastName.charAt(0)}
                                                </div>
                                                <div>
                                                    <div style="font-weight: 500;">${member.firstName} ${member.lastName}</div>
                                                    <div style="font-size: 0.75rem; color: #6B7280;">${member.email}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.25rem;">
                                                <span>${member.roleIcon}</span>
                                                <span>${member.roleName}</span>
                                            </div>
                                        </td>
                                        <td>${member.speciality}</td>
                                        <td>
                                            <span style="background: #F3F4F6; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                                                ${member.region}
                                            </span>
                                        </td>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <div style="width: 50px; height: 4px; background: #E5E7EB; border-radius: 2px; overflow: hidden;">
                                                    <div style="width: ${member.performanceScore}%; height: 100%; background: ${member.performanceScore >= 80 ? '#10B981' : member.performanceScore >= 60 ? '#F59E0B' : '#EF4444'};"></div>
                                                </div>
                                                <span style="font-size: 0.75rem; font-weight: 600; color: ${member.performanceScore >= 80 ? '#10B981' : member.performanceScore >= 60 ? '#F59E0B' : '#EF4444'};">
                                                    ${member.performanceScore}%
                                                </span>
                                            </div>
                                        </td>
                                        <td style="font-size: 0.75rem; color: #6B7280;">${formatDate(member.lastActivity)}</td>
                                        <td>
                                            <span class="status-badge ${member.status}">${getStatusLabel(member.status)}</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewStaffProfile('${member.id}')">üë§ Profil</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    document.getElementById('staff-directory-table').innerHTML = staffHtml;

                    // Load performance chart
                    const performanceHtml = data.data.performance.map(dept => `
                        <div style="background: white; border: 1px solid #E5E7EB; border-radius: 8px; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <h4 style="margin: 0; font-size: 0.875rem; color: #374151;">${dept.department}</h4>
                                <span style="font-size: 0.75rem; color: #6B7280;">${dept.memberCount} membres</span>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1F2937; margin-bottom: 0.5rem;">${dept.avgScore}%</div>
                            <div style="width: 100%; height: 6px; background: #E5E7EB; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${dept.avgScore}%; height: 100%; background: ${dept.avgScore >= 80 ? '#10B981' : dept.avgScore >= 60 ? '#F59E0B' : '#EF4444'};"></div>
                            </div>
                            <div style="font-size: 0.75rem; color: #6B7280; margin-top: 0.5rem;">Performance moyenne</div>
                        </div>
                    `).join('');

                    document.getElementById('staff-performance-chart').innerHTML = performanceHtml;
                }
            } catch (error) {
                console.error('Erreur chargement staff:', error);
                document.getElementById('staff-directory-table').innerHTML = '<p style="color: #EF4444;">‚ùå Erreur de chargement du personnel</p>';
            }
        }

        // Create New Role
        function createNewRole() {
            // Reset form to default template
            document.getElementById('roleName').value = '';
            document.getElementById('roleLevel').value = '5';
            document.getElementById('roleDescription').value = '';
            
            // Uncheck all permissions
            document.querySelectorAll('input[id^="perm-"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        // Save Role
        async function saveRole() {
            const roleData = {
                name: document.getElementById('roleName').value,
                level: parseInt(document.getElementById('roleLevel').value),
                description: document.getElementById('roleDescription').value,
                permissions: {}
            };

            // Collect permissions
            const permissionCategories = ['users', 'content', 'finance', 'system'];
            const permissionActions = ['read', 'create', 'edit', 'delete', 'validate', 'manage', 'reports', 'admin', 'backup', 'config'];

            permissionCategories.forEach(category => {
                roleData.permissions[category] = {};
                permissionActions.forEach(action => {
                    const checkbox = document.getElementById(`perm-${category}-${action}`);
                    if (checkbox) {
                        roleData.permissions[category][action] = checkbox.checked;
                    }
                });
            });

            if (!roleData.name || !roleData.description) {
                showRoleResult('‚ùå Veuillez remplir le nom et la description du r√¥le', 'error');
                return;
            }

            try {
                showRoleResult('üíæ Sauvegarde du r√¥le en cours...', 'info');

                const response = await fetch(`${API_BASE}/api/admin/roles`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(roleData)
                });

                const data = await response.json();

                if (data.success) {
                    showRoleResult(`‚úÖ R√¥le "${roleData.name}" cr√©√© avec succ√®s !`, 'success');
                    resetRoleForm();
                    await loadRolesManagementData();
                } else {
                    showRoleResult(`‚ùå Erreur: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Erreur cr√©ation r√¥le:', error);
                showRoleResult('‚ùå Erreur de connexion au serveur', 'error');
            }
        }

        // Reset Role Form
        function resetRoleForm() {
            document.getElementById('roleName').value = '';
            document.getElementById('roleLevel').value = '5';
            document.getElementById('roleDescription').value = '';
            
            document.querySelectorAll('input[id^="perm-"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        // Add Staff Member
        async function addStaffMember() {
            const staffData = {
                firstName: document.getElementById('staffFirstName').value,
                lastName: document.getElementById('staffLastName').value,
                email: document.getElementById('staffEmail').value,
                phone: document.getElementById('staffPhone').value,
                role: document.getElementById('staffRole').value,
                region: document.getElementById('staffRegion').value,
                speciality: document.getElementById('staffSpeciality').value,
                hireDate: document.getElementById('staffHireDate').value,
                bio: document.getElementById('staffBio').value,
                sendWelcomeEmail: document.getElementById('sendWelcomeEmail').checked
            };

            if (!staffData.firstName || !staffData.lastName || !staffData.email) {
                showStaffResult('‚ùå Veuillez remplir les champs obligatoires (pr√©nom, nom, email)', 'error');
                return;
            }

            try {
                showStaffResult('üë§ Ajout du membre en cours...', 'info');

                const response = await fetch(`${API_BASE}/api/admin/staff`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(staffData)
                });

                const data = await response.json();

                if (data.success) {
                    showStaffResult(`‚úÖ ${staffData.firstName} ${staffData.lastName} ajout√©(e) avec succ√®s !`, 'success');
                    resetStaffForm();
                    await loadStaffManagementData();
                } else {
                    showStaffResult(`‚ùå Erreur: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Erreur ajout staff:', error);
                showStaffResult('‚ùå Erreur de connexion au serveur', 'error');
            }
        }

        // Reset Staff Form
        function resetStaffForm() {
            document.getElementById('staffFirstName').value = '';
            document.getElementById('staffLastName').value = '';
            document.getElementById('staffEmail').value = '';
            document.getElementById('staffPhone').value = '';
            document.getElementById('staffRole').value = 'teacher';
            document.getElementById('staffRegion').value = 'centre';
            document.getElementById('staffSpeciality').value = 'mathematics';
            document.getElementById('staffHireDate').value = '';
            document.getElementById('staffBio').value = '';
            document.getElementById('sendWelcomeEmail').checked = true;
        }

        // Show role result
        function showRoleResult(message, type) {
            const resultDiv = document.getElementById('role-creation-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = message;
            
            if (type === 'success') {
                resultDiv.style.backgroundColor = '#D1FAE5';
                resultDiv.style.color = '#065F46';
                resultDiv.style.border = '1px solid #A7F3D0';
            } else if (type === 'error') {
                resultDiv.style.backgroundColor = '#FEE2E2';
                resultDiv.style.color = '#991B1B';
                resultDiv.style.border = '1px solid #FECACA';
            } else {
                resultDiv.style.backgroundColor = '#DBEAFE';
                resultDiv.style.color = '#1E40AF';
                resultDiv.style.border = '1px solid #93C5FD';
            }

            if (type !== 'error') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Show staff result
        function showStaffResult(message, type) {
            const resultDiv = document.getElementById('staff-addition-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = message;
            
            if (type === 'success') {
                resultDiv.style.backgroundColor = '#D1FAE5';
                resultDiv.style.color = '#065F46';
                resultDiv.style.border = '1px solid #A7F3D0';
            } else if (type === 'error') {
                resultDiv.style.backgroundColor = '#FEE2E2';
                resultDiv.style.color = '#991B1B';
                resultDiv.style.border = '1px solid #FECACA';
            } else {
                resultDiv.style.backgroundColor = '#DBEAFE';
                resultDiv.style.color = '#1E40AF';
                resultDiv.style.border = '1px solid #93C5FD';
            }

            if (type !== 'error') {
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Additional utility functions
        function editRole(roleId) {
            alert(`√âdition du r√¥le ${roleId} - Fonctionnalit√© √† impl√©menter`);
        }

        function viewStaffProfile(staffId) {
            alert(`Profil du membre ${staffId} - Fonctionnalit√© √† impl√©menter`);
        }

        function importStaffCSV() {
            alert('Import CSV du personnel - Fonctionnalit√© √† impl√©menter');
        }

        function exportStaffDirectory() {
            alert('Export de l\'annuaire - Fonctionnalit√© √† impl√©menter');
        }

        // Fonctions utilitaires
        function formatCurrency(amount) {
            return new Intl.NumberFormat('fr-FR').format(amount) + ' FCFA';
        }

        // === GESTION DES LIAISONS FAMILLE-√âTUDIANTS ===
        
        // Recherche de liaisons familiales
        function searchFamilyLinks() {
            const familySearch = document.getElementById('familySearch').value;
            const studentSearch = document.getElementById('studentSearch').value;
            const statusFilter = document.getElementById('linkStatusFilter').value;
            
            console.log('üîç Recherche liaisons:', { familySearch, studentSearch, statusFilter });
            
            // Simuler une recherche API
            showNotification('Recherche en cours...', 'info');
            
            setTimeout(() => {
                loadFamilyLinksData({ familySearch, studentSearch, statusFilter });
                showNotification('Recherche termin√©e', 'success');
            }, 1000);
        }
        
        // Charger les donn√©es de liaisons
        function loadFamilyLinksData(filters = {}) {
            // Donn√©es simul√©es - √Ä remplacer par un appel API r√©el
            const mockData = [
                {
                    familyId: 'FAM-001234',
                    familyName: 'Famille Nkoulou',
                    students: [
                        { name: 'Marie Nkoulou', level: 'Terminale A', status: 'linked' },
                        { name: 'Jean Nkoulou', level: '3√®me', status: 'linked' }
                    ],
                    status: 'active',
                    lastActivity: 'Il y a 2 heures'
                },
                {
                    familyId: 'FAM-002567',
                    familyName: 'Famille Abena',
                    students: [
                        { name: 'Paul Abena', level: '1√®re S', status: 'orphaned' }
                    ],
                    status: 'warning',
                    lastActivity: 'Il y a 1 jour'
                }
            ];
            
            updateFamilyLinksTable(mockData);
            updateOrphanStudentsTable();
            updateFamilyLinksStats();
        }
        
        // Mettre √† jour le tableau des liaisons
        function updateFamilyLinksTable(data) {
            const tbody = document.getElementById('familyLinksTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = data.map(family => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                ${family.familyName.split(' ')[1].substring(0, 2).toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${family.familyName}</div>
                                <div style="font-size: 0.875rem; color: #6B7280;">${family.familyId}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            ${family.students.map(student => `
                                <span class="glass-badge ${student.status === 'linked' ? 'glass-badge-success' : 'glass-badge-warning'}">
                                    ${student.status === 'linked' ? 'üìö' : '‚ö†Ô∏è'} ${student.name} (${student.level})${student.status === 'orphaned' ? ' - Orphelin' : ''}
                                </span>
                            `).join('')}
                        </div>
                    </td>
                    <td>
                        <span class="glass-badge ${family.status === 'active' ? 'glass-badge-success' : 'glass-badge-warning'}">
                            ${family.status === 'active' ? '‚úÖ Actif' : '‚ö†Ô∏è Liaison manquante'}
                        </span>
                    </td>
                    <td>${family.lastActivity}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-outline" onclick="viewFamilyDetails('${family.familyId}')" title="Voir d√©tails">
                                üëÅÔ∏è
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="manageFamilyLinks('${family.familyId}')" title="G√©rer liaisons">
                                üîó
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editFamily('${family.familyId}')" title="Modifier">
                                ‚úèÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Mettre √† jour le tableau des √©tudiants orphelins
        function updateOrphanStudentsTable() {
            const tbody = document.getElementById('orphanStudentsTableBody');
            if (!tbody) return;
            
            // Donn√©es simul√©es des √©tudiants orphelins
            const orphanStudents = [
                {
                    studentId: 'STU-003456',
                    name: 'Claude Kameni',
                    level: 'Terminale C',
                    registrationDate: '15 Mars 2024',
                    email: 'claude.kameni@email.com',
                    phone: '+237 696 123 456'
                },
                {
                    studentId: 'STU-004789',
                    name: 'Fatima Ousmane',
                    level: '1√®re D',
                    registrationDate: '22 Mars 2024',
                    email: 'fatima.ousmane@email.com',
                    phone: '+237 677 234 567'
                }
            ];
            
            tbody.innerHTML = orphanStudents.map(student => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4facfe, #00f2fe); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                ${student.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${student.name}</div>
                                <div style="font-size: 0.875rem; color: #6B7280;">${student.studentId}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="glass-badge glass-badge-primary">${student.level}</span>
                    </td>
                    <td>${student.registrationDate}</td>
                    <td>
                        <div style="font-size: 0.875rem;">
                            <div>üìß ${student.email}</div>
                            <div>üì± ${student.phone}</div>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-success" onclick="assignToFamily('${student.studentId}')" title="Assigner √† famille">
                                üë®‚Äçüë©‚Äçüëß‚Äçüë¶
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="createNewFamily('${student.studentId}')" title="Cr√©er nouvelle famille">
                                ‚ûïüë®‚Äçüë©‚Äçüëß‚Äçüë¶
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Mettre √† jour les statistiques
        function updateFamilyLinksStats() {
            const stats = {
                totalFamilies: 248,
                totalStudents: 832,
                linkedStudents: 756,
                orphanStudents: 76
            };
            
            document.getElementById('totalFamilies').textContent = stats.totalFamilies;
            document.getElementById('totalStudents').textContent = stats.totalStudents;
            document.getElementById('linkedStudents').textContent = stats.linkedStudents;
            document.getElementById('orphanStudents').textContent = stats.orphanStudents;
        }
        
        // Actions sp√©cifiques
        function viewFamilyDetails(familyId) {
            console.log('üëÅÔ∏è Voir d√©tails famille:', familyId);
            showNotification(`Ouverture des d√©tails de ${familyId}`, 'info');
        }
        
        function manageFamilyLinks(familyId) {
            console.log('üîó G√©rer liaisons famille:', familyId);
            showNotification(`Gestion des liaisons pour ${familyId}`, 'info');
        }
        
        function editFamily(familyId) {
            console.log('‚úèÔ∏è Modifier famille:', familyId);
            showNotification(`Modification de ${familyId}`, 'info');
        }
        
        function linkOrphanStudent(familyId) {
            console.log('üîó‚ûï Lier √©tudiant orphelin √†:', familyId);
            showNotification(`Liaison d'√©tudiant orphelin √† ${familyId}`, 'success');
        }
        
        function assignToFamily(studentId) {
            console.log('üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Assigner √©tudiant √† famille:', studentId);
            showNotification(`Assignation de ${studentId} √† une famille`, 'info');
        }
        
        function createNewFamily(studentId) {
            console.log('‚ûïüë®‚Äçüë©‚Äçüëß‚Äçüë¶ Cr√©er nouvelle famille pour:', studentId);
            showNotification(`Cr√©ation d'une nouvelle famille pour ${studentId}`, 'success');
        }
        
        function openLinkStudentModal() {
            console.log('‚ûï Ouvrir modal cr√©ation liaison');
            showNotification('Ouverture du modal de cr√©ation de liaison', 'info');
        }
        
        function detectOrphanedStudents() {
            console.log('‚ö†Ô∏è D√©tection des √©tudiants orphelins');
            showNotification('D√©tection des √©tudiants orphelins...', 'info');
            
            setTimeout(() => {
                updateOrphanStudentsTable();
                showNotification('D√©tection termin√©e - 2 orphelins trouv√©s', 'warning');
            }, 2000);
        }
        
        function autoLinkOrphans() {
            console.log('ü§ñ Liaison automatique des orphelins');
            showNotification('Liaison automatique en cours...', 'info');
            
            setTimeout(() => {
                showNotification('Liaison automatique termin√©e - 1 √©tudiant li√©', 'success');
                updateFamilyLinksStats();
                updateOrphanStudentsTable();
            }, 3000);
        }
        
        // Initialisation lors du changement vers la section family-links
        function initializeFamilyLinksSection() {
            loadFamilyLinksData();
        }
        
        // === FIN GESTION LIAISONS FAMILLE-√âTUDIANTS ===

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getStatusLabel(status) {
            const labels = {
                active: 'Actif',
                pending: 'En attente',
                inactive: 'Inactif',
                trial: 'Essai',
                completed: 'Termin√©'
            };
            return labels[status] || status;
        }

        function getSubscriptionLabel(type) {
            const labels = {
                basic: 'Basique',
                premium: 'Premium',
                trial: 'Essai',
                family: 'Famille'
            };
            return labels[type] || type;
        }

        function getPaymentMethodLabel(method) {
            const labels = {
                mtn_momo: 'MTN MoMo',
                orange_money: 'Orange Money',
                bank_transfer: 'Virement bancaire'
            };
            return labels[method] || method;
        }

        // Fonctions pour la cr√©ation de comptes
        function showCreateAccountModal() {
            console.log('üîµ showCreateAccountModal() appel√©e');
            const modal = document.getElementById('createAccountModal');
            if (modal) {
                modal.style.display = 'block';
                console.log('‚úÖ Modal nouveau compte affich√©');
            } else {
                console.error('‚ùå Element createAccountModal non trouv√©');
            }
            const typeStep = document.querySelector('#accountTypeStep');
            const formStep = document.querySelector('#accountFormStep');
            const previewStep = document.querySelector('#accountPreviewStep');
            
            if (typeStep) typeStep.style.display = 'block';
            if (formStep) formStep.style.display = 'none';
            if (previewStep) previewStep.style.display = 'none';
        }

        function selectAccountType(type) {
            const formStep = document.querySelector('#accountFormStep');
            const formContainer = document.querySelector('#accountForm');
            
            document.querySelector('#accountTypeStep').style.display = 'none';
            formStep.style.display = 'block';

            let formHtml = '';
            if (type === 'individual') {
                formHtml = `
                    <div class="form-group">
                        <label for="firstName">Pr√©nom *</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Nom *</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">T√©l√©phone *</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="dateOfBirth">Date de naissance</label>
                        <input type="date" id="dateOfBirth" name="dateOfBirth">
                    </div>
                    <div class="form-group">
                        <label for="subscription">Type d'abonnement *</label>
                        <select id="subscription" name="subscription" required>
                            <option value="">S√©lectionner...</option>
                            <option value="basic">Basique (5000 FCFA/mois)</option>
                            <option value="premium">Premium (8000 FCFA/mois)</option>
                            <option value="trial">Essai gratuit (7 jours)</option>
                        </select>
                    </div>
                    <input type="hidden" name="accountType" value="individual">
                `;
            } else {
                formHtml = `
                    <div class="form-group">
                        <label for="familyName">Nom de famille *</label>
                        <input type="text" id="familyName" name="familyName" required>
                    </div>
                    <div class="form-group">
                        <label for="parentFirstName">Pr√©nom du parent *</label>
                        <input type="text" id="parentFirstName" name="parentFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="parentLastName">Nom du parent *</label>
                        <input type="text" id="parentLastName" name="parentLastName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">T√©l√©phone *</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="numChildren">Nombre d'enfants *</label>
                        <input type="number" id="numChildren" name="numChildren" min="1" max="10" required>
                    </div>
                    <div class="form-group">
                        <label for="subscription">Type d'abonnement *</label>
                        <select id="subscription" name="subscription" required>
                            <option value="">S√©lectionner...</option>
                            <option value="family-basic">Famille Basique (12000 FCFA/mois)</option>
                            <option value="family-premium">Famille Premium (18000 FCFA/mois)</option>
                            <option value="trial">Essai gratuit (14 jours)</option>
                        </select>
                    </div>
                    <input type="hidden" name="accountType" value="family">
                `;
            }
            
            formContainer.innerHTML = formHtml;
        }

        function validateAccountForm() {
            const form = document.querySelector('#accountForm');
            const formData = new FormData(form);
            const errors = [];

            // Validation des champs obligatoires
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    errors.push(`Le champ "${field.previousElementSibling.textContent.replace(' *', '')}" est obligatoire`);
                }
            });

            // Validation email
            const email = formData.get('email');
            if (email && !email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                errors.push('Format email invalide');
            }

            // Validation t√©l√©phone
            const phone = formData.get('phone');
            if (phone && !phone.match(/^[+]?[0-9\s-()]{8,}$/)) {
                errors.push('Format t√©l√©phone invalide');
            }

            if (errors.length > 0) {
                alert('Erreurs de validation:\n' + errors.join('\n'));
                return false;
            }

            showAccountPreview(formData);
            return true;
        }

        function showAccountPreview(formData) {
            const accountType = formData.get('accountType');
            const subscription = formData.get('subscription');
            
            // G√©n√©ration de l'ID abonn√©
            const timestamp = Date.now();
            const randomNum = Math.floor(Math.random() * 100000).toString().padStart(5, '0');
            const subscriberId = accountType === 'family' ? `FAM-${randomNum}` : `IND-${randomNum}`;
            
            let previewHtml = `
                <div class="form-group">
                    <label>ID Abonn√©:</label>
                    <div style="font-weight: bold; color: ${accountType === 'family' ? '#10B981' : '#3B82F6'};">
                        ${subscriberId}
                    </div>
                </div>
                <div class="form-group">
                    <label>Type de compte:</label>
                    <div>${accountType === 'family' ? 'Compte Familial' : 'Compte Individuel'}</div>
                </div>
            `;

            if (accountType === 'individual') {
                previewHtml += `
                    <div class="form-group">
                        <label>Nom complet:</label>
                        <div>${formData.get('firstName')} ${formData.get('lastName')}</div>
                    </div>
                `;
            } else {
                previewHtml += `
                    <div class="form-group">
                        <label>Famille:</label>
                        <div>${formData.get('familyName')}</div>
                    </div>
                    <div class="form-group">
                        <label>Parent:</label>
                        <div>${formData.get('parentFirstName')} ${formData.get('parentLastName')}</div>
                    </div>
                    <div class="form-group">
                        <label>Nombre d'enfants:</label>
                        <div>${formData.get('numChildren')}</div>
                    </div>
                `;
            }

            previewHtml += `
                <div class="form-group">
                    <label>Email:</label>
                    <div>${formData.get('email')}</div>
                </div>
                <div class="form-group">
                    <label>T√©l√©phone:</label>
                    <div>${formData.get('phone')}</div>
                </div>
                <div class="form-group">
                    <label>Abonnement:</label>
                    <div>${getSubscriptionLabel(subscription)}</div>
                </div>
            `;

            document.querySelector('#accountPreview').innerHTML = previewHtml;
            document.querySelector('#accountFormStep').style.display = 'none';
            document.querySelector('#accountPreviewStep').style.display = 'block';

            // Stocker les donn√©es pour la cr√©ation
            window.accountCreationData = {
                subscriberId,
                accountType,
                formData: Object.fromEntries(formData)
            };
        }

        function goBackToForm() {
            document.querySelector('#accountPreviewStep').style.display = 'none';
            document.querySelector('#accountFormStep').style.display = 'block';
        }

        async function createAccount() {
            try {
                const accountData = window.accountCreationData;
                
                const response = await fetch(`${API_BASE}/api/admin/accounts/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(accountData)
                });

                const result = await response.json();

                if (result.success) {
                    alert(`Compte cr√©√© avec succ√®s!\nID Abonn√©: ${accountData.subscriberId}`);
                    closeModal('createAccountModal');
                    
                    // Recharger la liste des abonn√©s
                    if (document.querySelector('#subscribers-section').classList.contains('active')) {
                        loadSubscribersData();
                    }
                } else {
                    alert('Erreur lors de la cr√©ation du compte: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur technique lors de la cr√©ation du compte');
            }
        }

        // Fonctions pour la gestion des plans tarifaires
        async function loadPricingPlansData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/pricing-plans`);
                const data = await response.json();

                if (data.success) {
                    displayPricingPlans(data.data.plans);
                    updatePricingStats(data.data.stats);
                } else {
                    document.getElementById('pricing-plans-grid').innerHTML = '<p>Erreur lors du chargement des plans</p>';
                }
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('pricing-plans-grid').innerHTML = '<p>Erreur de connexion</p>';
            }
        }

        function displayPricingPlans(plans) {
            const plansGrid = document.getElementById('pricing-plans-grid');
            
            if (!plans || plans.length === 0) {
                plansGrid.innerHTML = '<p style="text-align: center; color: #6B7280;">Aucun plan tarifaire configur√©</p>';
                return;
            }

            const plansHtml = plans.map(plan => {
                const featuresHtml = plan.features.map(feature => `<li>${feature}</li>`).join('');
                const priceDisplay = plan.duration === 'trial' ? 'Gratuit' : `${plan.price.toLocaleString()} FCFA`;
                const durationLabel = {
                    monthly: '/mois',
                    quarterly: '/trimestre',
                    annual: '/an',
                    trial: `(${plan.trialDays} jours)`
                }[plan.duration];

                return `
                    <div class="plan-card ${plan.featured ? 'featured' : ''}">
                        <div class="plan-status ${plan.status}">${getStatusLabel(plan.status)}</div>
                        <div class="plan-header">
                            <div class="plan-name">${plan.name}</div>
                            <div class="plan-type ${plan.type}">${plan.type === 'family' ? 'Familial' : 'Individuel'}</div>
                            <div class="plan-price">${priceDisplay}</div>
                            <div class="plan-duration">${durationLabel}</div>
                        </div>
                        <div class="plan-features">
                            <ul>${featuresHtml}</ul>
                        </div>
                        <div class="plan-actions">
                            <button class="btn btn-sm btn-secondary" onclick="editPlan('${plan.id}')">‚úèÔ∏è Modifier</button>
                            <button class="btn btn-sm ${plan.status === 'active' ? 'btn-warning' : 'btn-success'}" 
                                    onclick="togglePlanStatus('${plan.id}', '${plan.status}')">
                                ${plan.status === 'active' ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            plansGrid.innerHTML = plansHtml;
        }

        function updatePricingStats(stats) {
            document.getElementById('active-plans-count').textContent = stats.activePlans;
            document.getElementById('monthly-revenue-plans').textContent = formatCurrency(stats.monthlyRevenue);
            document.getElementById('total-subscribers').textContent = stats.totalSubscribers;
            document.getElementById('popular-plan').textContent = stats.popularPlan || '-';
        }

        function showCreatePlanModal() {
            console.log('üîµ showCreatePlanModal() appel√©e');
            const modal = document.getElementById('createPlanModal');
            if (modal) {
                modal.style.display = 'block';
                console.log('‚úÖ Modal nouveau plan affich√©');
            } else {
                console.error('‚ùå Element createPlanModal non trouv√©');
            }
            document.getElementById('createPlanForm').reset();
            updatePlanFields();
        }

        function updatePlanFields() {
            const planType = document.getElementById('planType').value;
            const planDuration = document.getElementById('planDuration').value;
            
            // Afficher/masquer les champs sp√©cifiques aux familles
            const familyLimits = document.getElementById('familyLimits');
            familyLimits.style.display = planType === 'family' ? 'block' : 'none';
            
            // Afficher/masquer la dur√©e d'essai
            const trialDaysGroup = document.getElementById('trialDaysGroup');
            trialDaysGroup.style.display = planDuration === 'trial' ? 'block' : 'none';
            
            if (planDuration === 'trial') {
                document.getElementById('trialDays').setAttribute('required', 'required');
            } else {
                document.getElementById('trialDays').removeAttribute('required');
            }
        }

        function filterPlans() {
            const typeFilter = document.getElementById('planTypeFilter').value;
            const statusFilter = document.getElementById('planStatusFilter').value;
            
            const planCards = document.querySelectorAll('.plan-card');
            
            planCards.forEach(card => {
                let showCard = true;
                
                if (typeFilter) {
                    const planTypeEl = card.querySelector('.plan-type');
                    const cardType = planTypeEl.classList.contains('family') ? 'family' : 'individual';
                    if (cardType !== typeFilter) showCard = false;
                }
                
                if (statusFilter) {
                    const planStatusEl = card.querySelector('.plan-status');
                    if (!planStatusEl.classList.contains(statusFilter)) showCard = false;
                }
                
                card.style.display = showCard ? 'block' : 'none';
            });
        }

        function previewPlan() {
            const form = document.getElementById('createPlanForm');
            const formData = new FormData(form);
            
            // Validation
            const requiredFields = ['planName', 'planType', 'planCategory', 'planPrice', 'planDuration'];
            const errors = [];
            
            requiredFields.forEach(field => {
                if (!formData.get(field)) {
                    errors.push(`Le champ "${field}" est obligatoire`);
                }
            });
            
            if (formData.get('planDuration') === 'trial' && !formData.get('trialDays')) {
                errors.push('La dur√©e d\'essai est obligatoire pour un plan d\'essai');
            }
            
            if (errors.length > 0) {
                alert('Erreurs de validation:\n' + errors.join('\n'));
                return;
            }
            
            // Cr√©er aper√ßu
            const features = Array.from(form.querySelectorAll('input[name="features"]:checked')).map(cb => cb.value);
            const planData = {
                name: formData.get('planName'),
                type: formData.get('planType'),
                category: formData.get('planCategory'),
                price: parseInt(formData.get('planPrice')),
                duration: formData.get('planDuration'),
                trialDays: formData.get('trialDays'),
                features: features,
                maxChildren: formData.get('maxChildren'),
                maxDevices: formData.get('maxDevices'),
                description: formData.get('planDescription'),
                status: formData.get('planStatus'),
                featured: formData.get('planFeatured') === 'on'
            };
            
            alert(`Aper√ßu du plan:\n\nNom: ${planData.name}\nType: ${planData.type}\nPrix: ${planData.price} FCFA\nDur√©e: ${planData.duration}\nFonctionnalit√©s: ${features.join(', ')}`);
        }

        async function createPlan() {
            const form = document.getElementById('createPlanForm');
            const formData = new FormData(form);
            
            // Collecter les fonctionnalit√©s
            const features = Array.from(form.querySelectorAll('input[name="features"]:checked')).map(cb => cb.value);
            
            const planData = {
                name: formData.get('planName'),
                type: formData.get('planType'),
                category: formData.get('planCategory'),
                price: parseInt(formData.get('planPrice')),
                duration: formData.get('planDuration'),
                trialDays: formData.get('trialDays') ? parseInt(formData.get('trialDays')) : null,
                features: features,
                maxChildren: formData.get('maxChildren') ? parseInt(formData.get('maxChildren')) : null,
                maxDevices: formData.get('maxDevices') ? parseInt(formData.get('maxDevices')) : null,
                description: formData.get('planDescription'),
                status: formData.get('planStatus'),
                featured: formData.get('planFeatured') === 'on'
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/pricing-plans/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(planData)
                });

                const result = await response.json();

                if (result.success) {
                    alert('Plan cr√©√© avec succ√®s!');
                    closeModal('createPlanModal');
                    loadPricingPlansData();
                } else {
                    alert('Erreur lors de la cr√©ation du plan: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur technique lors de la cr√©ation du plan');
            }
        }

        async function togglePlanStatus(planId, currentStatus) {
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/pricing-plans/${planId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                const result = await response.json();

                if (result.success) {
                    loadPricingPlansData();
                } else {
                    alert('Erreur lors de la mise √† jour du statut');
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur technique');
            }
        }

        function editPlan(planId) {
            // Pour l'instant, afficher un message
            alert(`√âdition du plan ${planId} - Fonctionnalit√© √† d√©velopper`);
        }

        // Fonctions de test des API
        async function testClaudeAPI() {
            const apiKey = document.getElementById('claudeApiKey').value;
            const model = document.getElementById('claudeModel').value;
            
            if (!apiKey) {
                alert('Veuillez saisir une cl√© API Claude');
                return;
            }
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: model,
                        max_tokens: 100,
                        messages: [{ role: 'user', content: 'Test de connexion API' }]
                    })
                });
                
                if (response.ok) {
                    alert('‚úÖ Connexion Claude API r√©ussie!');
                } else {
                    const error = await response.json();
                    alert(`‚ùå Erreur Claude API: ${error.error?.message || 'Erreur inconnue'}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur de connexion: ${error.message}`);
            }
        }

        async function testOpenAI() {
            const apiKey = document.getElementById('openaiApiKey').value;
            const model = document.getElementById('openaiModel').value;
            
            if (!apiKey) {
                alert('Veuillez saisir une cl√© API OpenAI');
                return;
            }
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: 'user', content: 'Test de connexion API' }],
                        max_tokens: 50
                    })
                });
                
                if (response.ok) {
                    alert('‚úÖ Connexion OpenAI API r√©ussie!');
                } else {
                    const error = await response.json();
                    alert(`‚ùå Erreur OpenAI API: ${error.error?.message || 'Erreur inconnue'}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur de connexion: ${error.message}`);
            }
        }

        async function testSMSAPI() {
            const apiKey = document.getElementById('lmtApiKey').value;
            const apiUrl = document.getElementById('lmtApiUrl').value;
            const senderId = document.getElementById('lmtSenderId').value;
            
            if (!apiKey || !apiUrl) {
                alert('Veuillez configurer la cl√© API et l\'URL LMT SMS');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/test/sms`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        apiUrl: apiUrl,
                        senderId: senderId,
                        testNumber: '+237690000000'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Test SMS envoy√© avec succ√®s!');
                } else {
                    alert(`‚ùå Erreur SMS: ${result.message}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur: ${error.message}`);
            }
        }

        async function testEmailSMTP() {
            const smtpHost = document.getElementById('smtpHost').value;
            const smtpPort = document.getElementById('smtpPort').value;
            const smtpUser = document.getElementById('smtpUser').value;
            const smtpPassword = document.getElementById('smtpPassword').value;
            
            if (!smtpHost || !smtpUser || !smtpPassword) {
                alert('Veuillez configurer tous les champs SMTP');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/test/email`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        host: smtpHost,
                        port: smtpPort,
                        user: smtpUser,
                        password: smtpPassword,
                        testEmail: smtpUser
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Email de test envoy√© avec succ√®s!');
                } else {
                    alert(`‚ùå Erreur SMTP: ${result.message}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur: ${error.message}`);
            }
        }


        // Utility functions for notifications
        function showError(message) {
            alert(`‚ùå Erreur: ${message}`);
        }

        function showSuccess(message) {
            alert(`‚úÖ ${message}`);
        }

        // Get authentication token
        function getAuthToken() {
            return localStorage.getItem('claudyne_token');
        }

        // Password Change Functions
        function togglePasswordChange() {
            const form = document.getElementById('passwordChangeForm');
            if (form.style.display === 'none') {
                form.style.display = 'block';
                // Clear form fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } else {
                form.style.display = 'none';
            }
        }

        function cancelPasswordChange() {
            document.getElementById('passwordChangeForm').style.display = 'none';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        async function changeAdminPassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validation des champs
            if (!currentPassword || !newPassword || !confirmPassword) {
                showError('Veuillez remplir tous les champs');
                return;
            }

            if (newPassword !== confirmPassword) {
                showError('Les nouveaux mots de passe ne correspondent pas');
                return;
            }

            if (newPassword.length < 6) {
                showError('Le nouveau mot de passe doit contenir au moins 6 caract√®res');
                return;
            }

            try {
                const token = getAuthToken();
                if (!token) {
                    showError('Token d\'authentification manquant. Veuillez vous reconnecter.');
                    return;
                }

                const response = await fetch(`${API_BASE}/api/admin/profile/change-password`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        currentPassword: currentPassword,
                        newPassword: newPassword
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('Mot de passe modifi√© avec succ√®s !');
                    cancelPasswordChange();
                } else {
                    showError(data.message || 'Erreur lors de la modification du mot de passe');
                }

            } catch (error) {
                console.error('Erreur changement mot de passe:', error);
                showError('Erreur lors de la modification du mot de passe');
            }
        }
        // Fonction de sauvegarde des param√®tres
        async function saveSettings() {
            const settings = {
                general: {
                    siteName: document.getElementById('siteName').value,
                    tagline: document.getElementById('tagline').value,
                    supportEmail: document.getElementById('supportEmail').value,
                    supportPhone: document.getElementById('supportPhone').value
                },
                apis: {
                    claude: {
                        apiKey: document.getElementById('claudeApiKey').value,
                        model: document.getElementById('claudeModel').value
                    },
                    openai: {
                        apiKey: document.getElementById('openaiApiKey').value,
                        model: document.getElementById('openaiModel').value,
                        temperature: parseFloat(document.getElementById('openaiTemperature').value),
                        maxTokens: parseInt(document.getElementById('openaiMaxTokens').value),
                        systemPrompt: document.getElementById('openaiSystemPrompt').value,
                        enabled: document.getElementById('openaiEnabled').checked
                    },
                    sms: {
                        apiKey: document.getElementById('lmtApiKey').value,
                        apiUrl: document.getElementById('lmtApiUrl').value,
                        senderId: document.getElementById('lmtSenderId').value,
                        cost: parseInt(document.getElementById('smsCost').value)
                    },
                    smtp: {
                        host: document.getElementById('smtpHost').value,
                        port: parseInt(document.getElementById('smtpPort').value),
                        user: document.getElementById('smtpUser').value,
                        password: document.getElementById('smtpPassword').value,
                        tls: document.getElementById('smtpTls').checked
                    }
                }
            };

            try {
                const response = await fetch(`${API_BASE}/api/admin/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Param√®tres sauvegard√©s avec succ√®s!');
                } else {
                    alert(`‚ùå Erreur lors de la sauvegarde: ${result.message}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur: ${error.message}`);
            }
        }

        // Fonctions pour les abonn√©s
        async function searchSubscribers() {
            const searchQuery = document.querySelector('#subscriberSearch').value;
            const filterType = document.querySelector('#subscriberFilter').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/subscribers/search?q=${encodeURIComponent(searchQuery)}&type=${filterType}`);
                const result = await response.json();
                
                if (result.success) {
                    displaySubscribers(result.data);
                } else {
                    alert('Erreur lors de la recherche: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur de connexion lors de la recherche');
            }
        }

        function displaySubscribers(subscribers) {
            const subscribersTable = document.getElementById('subscribers-table');
            
            if (!subscribers || subscribers.length === 0) {
                subscribersTable.innerHTML = '<p>Aucun abonn√© trouv√©</p>';
                return;
            }

            const tableHtml = `
                <table class="glass-table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>ID Abonn√©</th>
                            <th>Nom</th>
                            <th>Type</th>
                            <th>Statut</th>
                            <th>Email</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${subscribers.map(subscriber => `
                            <tr>
                                <td>
                                    <span class="glass-badge ${subscriber.accountType === 'family' ? 'glass-badge-success' : 'glass-badge-primary'}">
                                        ${subscriber.subscriberId}
                                    </span>
                                </td>
                                <td>${subscriber.name}</td>
                                <td>${subscriber.accountType === 'family' ? 'Familial' : 'Individuel'}</td>
                                <td>
                                    <span class="glass-badge glass-badge-${subscriber.status === 'active' ? 'success' : 'warning'}">
                                        ${getStatusLabel(subscriber.status)}
                                    </span>
                                </td>
                                <td>${subscriber.email}</td>
                                <td>
                                    <button class="btn btn-sm glass-btn" onclick="editSubscriber('${subscriber.id}')">‚úèÔ∏è Modifier</button>
                                    <button class="btn btn-sm glass-btn glass-btn-warning" onclick="suspendSubscriber('${subscriber.id}')">‚è∏Ô∏è Suspendre</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            subscribersTable.innerHTML = tableHtml;
        }

        async function exportSubscribersCSV() {
            console.log('üîµ exportSubscribersCSV() appel√©e');
            try {
                const response = await fetch(`${API_BASE}/api/admin/subscribers/export`);
                const blob = await response.blob();
                
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `abonnes_claudyne_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                window.URL.revokeObjectURL(url);
                alert('‚úÖ Export CSV termin√©!');
            } catch (error) {
                console.error('Erreur:', error);
                alert('‚ùå Erreur lors de l\'export CSV');
            }
        }

        function editSubscriber(subscriberId) {
            alert(`√âdition de l'abonn√© ${subscriberId} - Fonctionnalit√© √† d√©velopper`);
        }

        async function suspendSubscriber(subscriberId) {
            if (!confirm('√ätes-vous s√ªr de vouloir suspendre cet abonn√© ?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/subscribers/${subscriberId}/suspend`, {
                    method: 'PUT'
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Abonn√© suspendu avec succ√®s');
                    searchSubscribers(); // Recharger la liste
                } else {
                    alert('‚ùå Erreur: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('‚ùå Erreur technique');
            }
        }

        // Fonctions pour la gestion de contenu
        function showContentTab(tabName) {
            // Masquer tous les tabs
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Masquer tous les boutons tab actifs
            document.querySelectorAll('.btn-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Afficher le tab s√©lectionn√©
            document.getElementById(tabName + '-tab').classList.add('active');
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // Charger le contenu du tab
            loadContentTabData(tabName);
        }

        async function loadContentTabData(tabName) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/content/${tabName}`);
                const result = await response.json();
                
                if (result.success) {
                    displayContentData(tabName, result.data);
                } else {
                    document.getElementById(tabName + '-content').innerHTML = 
                        '<p>Erreur lors du chargement du contenu</p>';
                }
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById(tabName + '-content').innerHTML = 
                    '<p>Erreur de connexion</p>';
            }
        }

        function displayContentData(tabType, data) {
            const container = document.getElementById(tabType + '-content');
            
            if (tabType === 'courses') {
                displayCourses(container, data);
            } else if (tabType === 'quizzes') {
                displayQuizzes(container, data);
            } else if (tabType === 'resources') {
                displayResources(container, data);
            }
        }

        function displayCourses(container, courses) {
            const coursesHtml = `
                <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Gestion des cours</h3>
                    <button class="btn btn-primary glass-btn glass-btn-primary" onclick="showAddCourseModal()">‚ûï Nouveau cours</button>
                </div>
                <div class="courses-grid">
                    ${courses.map(course => `
                        <div class="glass-card" style="margin-bottom: 1rem;">
                            <h4 class="glass-text-primary">${course.title}</h4>
                            <p class="glass-text-secondary">${course.description}</p>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-sm glass-btn" onclick="editCourse('${course.id}')">‚úèÔ∏è Modifier</button>
                                <button class="btn btn-sm glass-btn glass-btn-warning" onclick="toggleCourseStatus('${course.id}')">
                                    ${course.status === 'active' ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer'}
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = coursesHtml;
        }

        function displayQuizzes(container, quizzes) {
            const quizzesHtml = `
                <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Gestion des quiz</h3>
                    <button class="btn btn-primary glass-btn glass-btn-primary" onclick="showAddQuizModal()">‚ûï Nouveau quiz</button>
                </div>
                <div class="quizzes-grid">
                    ${quizzes.map(quiz => `
                        <div class="glass-card" style="margin-bottom: 1rem;">
                            <h4 class="glass-text-primary">${quiz.title}</h4>
                            <p class="glass-text-secondary">${quiz.questions.length} questions</p>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-sm glass-btn" onclick="editQuiz('${quiz.id}')">‚úèÔ∏è Modifier</button>
                                <button class="btn btn-sm glass-btn glass-btn-warning" onclick="toggleQuizStatus('${quiz.id}')">
                                    ${quiz.status === 'active' ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer'}
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = quizzesHtml;
        }

        function displayResources(container, resources) {
            const resourcesHtml = `
                <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Gestion des ressources</h3>
                    <button class="btn btn-primary glass-btn glass-btn-primary" onclick="showAddResourceModal()">‚ûï Nouvelle ressource</button>
                </div>
                <div class="resources-grid">
                    ${resources.map(resource => `
                        <div class="glass-card" style="margin-bottom: 1rem;">
                            <h4 class="glass-text-primary">${resource.title}</h4>
                            <p class="glass-text-secondary">${resource.type} - ${resource.size}</p>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-sm glass-btn" onclick="editResource('${resource.id}')">‚úèÔ∏è Modifier</button>
                                <button class="btn btn-sm glass-btn glass-btn-warning" onclick="deleteResource('${resource.id}')">üóëÔ∏è Supprimer</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = resourcesHtml;
        }

        // Fonctions pour l'ajout de contenu
        function showAddCourseModal() {
            console.log('üîµ showAddCourseModal() appel√©e');
            const modal = document.createElement('div');
            modal.className = 'glass-modal show';
            modal.innerHTML = `
                <div class="glass-modal-content" style="max-width: 600px;">
                    <h2 class="glass-text-primary" style="margin-bottom: 1.5rem;">Ajouter un nouveau cours</h2>
                    <form id="add-course-form" onsubmit="handleAddCourse(event)">
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Titre du cours:</label>
                            <input type="text" class="glass-input" name="title" required placeholder="Ex: Introduction √† la Physique">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Mati√®re:</label>
                            <select class="glass-input" name="subject" required>
                                <option value="">S√©lectionner une mati√®re</option>
                                <option value="mathematiques">Math√©matiques</option>
                                <option value="physique">Physique</option>
                                <option value="chimie">Chimie</option>
                                <option value="biologie">Biologie</option>
                                <option value="francais">Fran√ßais</option>
                                <option value="anglais">Anglais</option>
                                <option value="histoire">Histoire</option>
                                <option value="geographie">G√©ographie</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Niveau:</label>
                            <select class="glass-input" name="level" required>
                                <option value="">S√©lectionner un niveau</option>
                                <option value="6eme">6√®me</option>
                                <option value="5eme">5√®me</option>
                                <option value="4eme">4√®me</option>
                                <option value="3eme">3√®me</option>
                                <option value="2nde">2nde</option>
                                <option value="1ere">1√®re</option>
                                <option value="terminale">Terminale</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Description:</label>
                            <textarea class="glass-input" name="description" rows="3" placeholder="Description du cours..."></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Contenu du cours:</label>
                            <textarea class="glass-input" name="content" rows="6" placeholder="Contenu d√©taill√© du cours..." required></textarea>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Dur√©e estim√©e (minutes):</label>
                            <input type="number" class="glass-input" name="duration" min="1" placeholder="Ex: 45">
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" class="glass-btn" onclick="closeModalDynamic(this)">Annuler</button>
                            <button type="submit" class="glass-btn glass-btn-primary">Cr√©er le cours</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModalDynamic(modal);
            });
        }

        function showAddQuizModal() {
            console.log('üîµ showAddQuizModal() appel√©e');
            const modal = document.createElement('div');
            modal.className = 'glass-modal show';
            modal.innerHTML = `
                <div class="glass-modal-content" style="max-width: 700px;">
                    <h2 class="glass-text-primary" style="margin-bottom: 1.5rem;">Cr√©er un nouveau quiz</h2>
                    <form id="add-quiz-form" onsubmit="handleAddQuiz(event)">
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Titre du quiz:</label>
                            <input type="text" class="glass-input" name="title" required placeholder="Ex: Quiz Physique - Forces et mouvements">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Mati√®re:</label>
                            <select class="glass-input" name="subject" required>
                                <option value="">S√©lectionner une mati√®re</option>
                                <option value="mathematiques">Math√©matiques</option>
                                <option value="physique">Physique</option>
                                <option value="chimie">Chimie</option>
                                <option value="biologie">Biologie</option>
                                <option value="francais">Fran√ßais</option>
                                <option value="anglais">Anglais</option>
                                <option value="histoire">Histoire</option>
                                <option value="geographie">G√©ographie</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Niveau:</label>
                            <select class="glass-input" name="level" required>
                                <option value="">S√©lectionner un niveau</option>
                                <option value="6eme">6√®me</option>
                                <option value="5eme">5√®me</option>
                                <option value="4eme">4√®me</option>
                                <option value="3eme">3√®me</option>
                                <option value="2nde">2nde</option>
                                <option value="1ere">1√®re</option>
                                <option value="terminale">Terminale</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Description:</label>
                            <textarea class="glass-input" name="description" rows="2" placeholder="Description du quiz..."></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Dur√©e (minutes):</label>
                            <input type="number" class="glass-input" name="duration" min="1" value="20" required>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Note de passage (%):</label>
                            <input type="number" class="glass-input" name="passing_score" min="0" max="100" value="60" required>
                        </div>
                        <div id="quiz-questions" style="margin-bottom: 1.5rem;">
                            <h3 class="glass-text-primary" style="margin-bottom: 1rem;">Questions</h3>
                            <div class="quiz-question" style="margin-bottom: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 12px;">
                                <input type="text" class="glass-input" placeholder="Question 1" style="margin-bottom: 0.5rem;" name="question_1" required>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="text" class="glass-input" placeholder="Option A" name="option_1_a" required>
                                    <input type="text" class="glass-input" placeholder="Option B" name="option_1_b" required>
                                    <input type="text" class="glass-input" placeholder="Option C" name="option_1_c" required>
                                    <input type="text" class="glass-input" placeholder="Option D" name="option_1_d" required>
                                </div>
                                <select class="glass-input" name="correct_1" style="margin-top: 0.5rem;" required>
                                    <option value="">R√©ponse correcte</option>
                                    <option value="a">Option A</option>
                                    <option value="b">Option B</option>
                                    <option value="c">Option C</option>
                                    <option value="d">Option D</option>
                                </select>
                            </div>
                        </div>
                        <button type="button" class="glass-btn" onclick="addQuizQuestion()" style="margin-bottom: 1rem;">Ajouter une question</button>
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" class="glass-btn" onclick="closeModalDynamic(this)">Annuler</button>
                            <button type="submit" class="glass-btn glass-btn-primary">Cr√©er le quiz</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModalDynamic(modal);
            });
        }

        function showAddResourceModal() {
            const modal = document.createElement('div');
            modal.className = 'glass-modal show';
            modal.innerHTML = `
                <div class="glass-modal-content" style="max-width: 600px;">
                    <h2 class="glass-text-primary" style="margin-bottom: 1.5rem;">Ajouter une nouvelle ressource</h2>
                    <form id="add-resource-form" onsubmit="handleAddResource(event)">
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Titre de la ressource:</label>
                            <input type="text" class="glass-input" name="title" required placeholder="Ex: Formules math√©matiques importantes">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Type de ressource:</label>
                            <select class="glass-input" name="type" required>
                                <option value="">S√©lectionner un type</option>
                                <option value="document">Document PDF</option>
                                <option value="video">Vid√©o</option>
                                <option value="audio">Audio</option>
                                <option value="image">Image/Sch√©ma</option>
                                <option value="link">Lien externe</option>
                                <option value="exercise">Exercice</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Mati√®re:</label>
                            <select class="glass-input" name="subject" required>
                                <option value="">S√©lectionner une mati√®re</option>
                                <option value="mathematiques">Math√©matiques</option>
                                <option value="physique">Physique</option>
                                <option value="chimie">Chimie</option>
                                <option value="biologie">Biologie</option>
                                <option value="francais">Fran√ßais</option>
                                <option value="anglais">Anglais</option>
                                <option value="histoire">Histoire</option>
                                <option value="geographie">G√©ographie</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Niveau:</label>
                            <select class="glass-input" name="level" required>
                                <option value="">S√©lectionner un niveau</option>
                                <option value="6eme">6√®me</option>
                                <option value="5eme">5√®me</option>
                                <option value="4eme">4√®me</option>
                                <option value="3eme">3√®me</option>
                                <option value="2nde">2nde</option>
                                <option value="1ere">1√®re</option>
                                <option value="terminale">Terminale</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Description:</label>
                            <textarea class="glass-input" name="description" rows="3" placeholder="Description de la ressource..."></textarea>
                        </div>
                        <div id="file-upload-section" style="margin-bottom: 1rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">Fichier ou URL:</label>
                            <input type="text" class="glass-input" name="url" placeholder="URL du fichier ou lien externe">
                            <p class="glass-text-muted" style="font-size: 0.8rem; margin-top: 0.25rem;">Ou coller l'URL d'une ressource externe</p>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="glass-text-secondary" style="display: block; margin-bottom: 0.5rem;">
                                <input type="checkbox" name="is_premium" style="margin-right: 0.5rem;">
                                Ressource premium (r√©serv√©e aux abonn√©s)
                            </label>
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" class="glass-btn" onclick="closeModalDynamic(this)">Annuler</button>
                            <button type="submit" class="glass-btn glass-btn-primary">Ajouter la ressource</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModalDynamic(modal);
            });
        }

        // Fonction pour fermer les modals dynamiques
        function closeModalDynamic(element) {
            const modal = element.closest('.glass-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Fonction pour ajouter une question au quiz
        let quizQuestionCount = 1;
        function addQuizQuestion() {
            quizQuestionCount++;
            const questionsContainer = document.getElementById('quiz-questions');
            const newQuestion = document.createElement('div');
            newQuestion.className = 'quiz-question';
            newQuestion.style.cssText = 'margin-bottom: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 12px;';
            newQuestion.innerHTML = `
                <input type="text" class="glass-input" placeholder="Question ${quizQuestionCount}" style="margin-bottom: 0.5rem;" name="question_${quizQuestionCount}" required>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                    <input type="text" class="glass-input" placeholder="Option A" name="option_${quizQuestionCount}_a" required>
                    <input type="text" class="glass-input" placeholder="Option B" name="option_${quizQuestionCount}_b" required>
                    <input type="text" class="glass-input" placeholder="Option C" name="option_${quizQuestionCount}_c" required>
                    <input type="text" class="glass-input" placeholder="Option D" name="option_${quizQuestionCount}_d" required>
                </div>
                <select class="glass-input" name="correct_${quizQuestionCount}" style="margin-top: 0.5rem;" required>
                    <option value="">R√©ponse correcte</option>
                    <option value="a">Option A</option>
                    <option value="b">Option B</option>
                    <option value="c">Option C</option>
                    <option value="d">Option D</option>
                </select>
                <button type="button" class="glass-btn" style="margin-top: 0.5rem; background: rgba(239, 68, 68, 0.2);" onclick="removeQuizQuestion(this)">Supprimer cette question</button>
            `;
            questionsContainer.appendChild(newQuestion);
        }

        function removeQuizQuestion(button) {
            const questionDiv = button.closest('.quiz-question');
            if (questionDiv) {
                questionDiv.remove();
            }
        }

        // Fonctions de gestion des formulaires
        async function handleAddCourse(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const courseData = {
                title: formData.get('title'),
                subject: formData.get('subject'),
                level: formData.get('level'),
                description: formData.get('description'),
                content: formData.get('content'),
                duration: formData.get('duration') || 45,
                created_by: 'admin',
                created_at: new Date().toISOString()
            };

            try {
                const response = await fetch(`${API_BASE}/api/admin/courses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(courseData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('Cours cr√©√© avec succ√®s !');
                    closeModalDynamic(event.target);
                    loadContentData(); // Recharger les donn√©es
                } else {
                    alert('Erreur lors de la cr√©ation du cours: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de la cr√©ation du cours');
            }
        }

        async function handleAddQuiz(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const questions = [];
            
            // Collecter toutes les questions
            for (let i = 1; i <= quizQuestionCount; i++) {
                const question = formData.get(`question_${i}`);
                if (question) {
                    questions.push({
                        question: question,
                        options: {
                            a: formData.get(`option_${i}_a`),
                            b: formData.get(`option_${i}_b`),
                            c: formData.get(`option_${i}_c`),
                            d: formData.get(`option_${i}_d`)
                        },
                        correct_answer: formData.get(`correct_${i}`)
                    });
                }
            }

            const quizData = {
                title: formData.get('title'),
                subject: formData.get('subject'),
                level: formData.get('level'),
                description: formData.get('description'),
                duration: formData.get('duration'),
                passing_score: formData.get('passing_score'),
                questions: questions,
                created_by: 'admin',
                created_at: new Date().toISOString()
            };

            try {
                const response = await fetch(`${API_BASE}/api/admin/quizzes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(quizData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('Quiz cr√©√© avec succ√®s !');
                    closeModalDynamic(event.target);
                    quizQuestionCount = 1; // Reset counter
                    loadContentData(); // Recharger les donn√©es
                } else {
                    alert('Erreur lors de la cr√©ation du quiz: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de la cr√©ation du quiz');
            }
        }

        async function handleAddResource(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const resourceData = {
                title: formData.get('title'),
                type: formData.get('type'),
                subject: formData.get('subject'),
                level: formData.get('level'),
                description: formData.get('description'),
                url: formData.get('url'),
                is_premium: formData.has('is_premium'),
                created_by: 'admin',
                created_at: new Date().toISOString()
            };

            try {
                const response = await fetch(`${API_BASE}/api/admin/resources`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(resourceData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('Ressource ajout√©e avec succ√®s !');
                    closeModalDynamic(event.target);
                    loadContentData(); // Recharger les donn√©es
                } else {
                    alert('Erreur lors de l\'ajout de la ressource: ' + result.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de l\'ajout de la ressource');
            }
        }

        function editCourse(courseId) {
            alert(`√âdition du cours ${courseId} - √Ä impl√©menter`);
        }

        function editQuiz(quizId) {
            alert(`√âdition du quiz ${quizId} - √Ä impl√©menter`);
        }

        function editResource(resourceId) {
            alert(`√âdition de la ressource ${resourceId} - √Ä impl√©menter`);
        }

        async function toggleCourseStatus(courseId) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/content/courses/${courseId}/toggle`, {
                    method: 'PUT'
                });

                const result = await response.json();
                if (result.success) {
                    showContentTab('courses'); // Recharger
                } else {
                    alert('Erreur: ' + result.message);
                }
            } catch (error) {
                alert('Erreur technique');
            }
        }

        async function toggleQuizStatus(quizId) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/content/quizzes/${quizId}/toggle`, {
                    method: 'PUT'
                });

                const result = await response.json();
                if (result.success) {
                    showContentTab('quizzes'); // Recharger
                } else {
                    alert('Erreur: ' + result.message);
                }
            } catch (error) {
                alert('Erreur technique');
            }
        }

        // Fonctions pour la gestion d'√©quipe
        function addStaffMember() {
            alert('Modal d\'ajout de membre d\'√©quipe - √Ä impl√©menter');
        }

        // Fonctions pour la communication
        async function sendMessage() {
            const messageData = {
                type: document.getElementById('messageType').value,
                channel: document.getElementById('messageChannel').value,
                subject: document.getElementById('messageSubject').value,
                content: document.getElementById('messageContent').value,
                recipients: document.getElementById('messageRecipients').value
            };

            try {
                const response = await fetch(`${API_BASE}/api/admin/messages/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(messageData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Message envoy√© avec succ√®s!');
                    // R√©initialiser le formulaire
                    document.getElementById('messageSubject').value = '';
                    document.getElementById('messageContent').value = '';
                } else {
                    alert('‚ùå Erreur: ' + result.message);
                }
            } catch (error) {
                alert('‚ùå Erreur technique');
            }
        }

        // Fonctions pour les rapports
        async function generateReport() {
            console.log('üîµ generateReport() appel√©e');
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = document.getElementById('reportPeriod').value;

            try {
                const response = await fetch(`${API_BASE}/api/admin/reports/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: reportType, period: reportPeriod })
                });

                if (response.headers.get('content-type').includes('application/pdf')) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `rapport_${reportType}_${new Date().toISOString().split('T')[0]}.pdf`;
                    link.click();
                    window.URL.revokeObjectURL(url);
                    alert('‚úÖ Rapport g√©n√©r√© et t√©l√©charg√©!');
                } else {
                    const result = await response.json();
                    alert('‚ùå Erreur: ' + result.message);
                }
            } catch (error) {
                alert('‚ùå Erreur technique');
            }
        }

        // Fonctions pour la gestion des essais
        function showTrialManagement() {
            showSection('trial-management');
        }

        async function extendTrial() {
            const subscriberId = prompt('ID de l\'abonn√©:');
            const extensionDays = prompt('Nombre de jours d\'extension:');

            if (!subscriberId || !extensionDays) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/subscribers/${subscriberId}/extend-trial`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days: parseInt(extensionDays) })
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Essai √©tendu avec succ√®s!');
                } else {
                    alert('‚ùå Erreur: ' + result.message);
                }
            } catch (error) {
                alert('‚ùå Erreur technique');
            }
        }

        // Fonctions utilitaires pour les modals
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
            }
        }

        // Fonction showSection maintenant d√©finie au d√©but du script

        // Chargement initial
        window.addEventListener('load', function() {
            loadDashboardData();
        });
    </script>
    
    <!-- Script d'optimisation r√©seau pour 2G/3G -->
    <script src="js/network-optimization.js"></script>
</body>
</html>